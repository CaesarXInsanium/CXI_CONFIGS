var demo_mode=0;var password_insert_success=0;var achievement_input=jQuery("input[name='testId']");const passwordElement="undefined"!==typeof password_el?password_el:":password:visible";var password_inputs=jQuery(passwordElement);var selected_field=jQuery(".hl-active-password");var lock_selected=jQuery(".hl-lock-selected");let appendSrc=chrome.runtime.getURL("js_web/external/external_append.js");if(password_inputs.length<1)password_inputs=achievement_input;chrome.extension.onMessage.addListener((function(msg,sender,sendResponse){if("devtools_open"==msg.action)if(0==password_insert_success||password_insert_success>0&&1===jQuery(".hl-lock-selected").length){chrome.runtime.sendMessage({message:"show_insert_password_button"});resetActiveInputs();resetDummyPasswordField();insertPromptExternalExams("DevTools Open","Tampering with the password module is prohibited. Your instructor will be notified.")}if("check_external_code_exists"==msg.action)if(jQuery(passwordElement).length>0)sendResponse(true);else sendResponse(false);if("check_password_locked"==msg.action)if(1===jQuery(".hl-lock-selected").length)sendResponse(true);else sendResponse(false);if("reinsert_access_code"==msg.action){password_inputs=jQuery(passwordElement);selected_field=jQuery(".hl-active-password");lock_selected=jQuery(".hl-lock-selected");resetActiveInputs();passwordHandler()}if("camera_window_closed"==msg.action){resetActiveInputs();chrome.runtime.sendMessage({message:"disable_browser_guard"})}if("reset_state"==msg.action){resetActiveInputs();chrome.runtime.sendMessage({message:"disable_browser_guard"})}}));if(selected_field.length)insertPassword(selected_field);else resetActiveInputs();password_inputs.each((function(){jQuery(this).addClass("hl-transition-password")}));function highlightSelectedInput(el){jQuery(el).addClass("hl-active-password")}function highlightPossibleInputs(){password_inputs.each((function(){if(!jQuery(this).hasClass("hl-active-password"))jQuery(this).addClass("hl-possible-password")}))}function resetActiveInputs(){jQuery(".hl-lock-selected").attr("type","password");jQuery(".hl-lock-selected").prop("readonly",false);password_inputs.each((function(){let input=jQuery(this);input.removeClass("hl-possible-password");input.removeClass("hl-active-password");input.removeClass("hl-lock-selected");input.removeClass("hl-lock-square");input.removeClass("hl-transition-password");input.val("")}));unmaskInputsWithPasswordAttributes()}password_inputs.click((function(){resetActiveInputs();jQuery(this).addClass("hl-active-password")}));passwordHandler();function passwordHandler(){maskInputsWithPasswordAttributes();if(selected_field.length<1){if(password_inputs.length>1){highlightPossibleInputs();insertPromptExternalExams("Multiple Password Fields","There are multiple password fields on this page. Click on the correct password field and then try again.")}else if(password_inputs.length<1&&jQuery(".hl-lock-selected").length<1){insertPromptExternalExams("No Password Field","No password inputs found. Find the exam page with a password field and try again.");access_code=null}else if(1==password_inputs.length)insertPassword(password_inputs)}else insertPassword(selected_field)}function maskInputsWithPasswordAttributes(){jQuery("input[name*='password']").each((function(){jQuery(this).addClass("hl-masked-input")}))}function unmaskInputsWithPasswordAttributes(){jQuery("input[name*='password']").each((function(){jQuery(this).removeClass("hl-masked-input");jQuery(this).val("")}))}function insertPromptExternalExams(header,text,dismiss,icon){removePrompts();var header=header||"Error";var text=text||"An error has occurred";var icon=icon||hlIcons.exclamationTriangle;var dismiss=dismiss||"dismiss";jQuery("body").append(`\n\t\t<div class="hl-prompt">\n\t\t\t<div id="hl-prompt-container">\n\t\t\t    <div id="hl-close-prompt" class="hl-close-prompt btn">X</div>\n\t\t\t    <div class="hl-prompt-header">\n\t\t\t        <h2 id="hl-prompt-header-text">${icon} ${header}</h2>\n\t\t\t        <p id="hl-prompt-body">${text}</p>\n\t\t\t    </div>\n\t\t\t</div>\n\t\t</div>\n\t`);jQuery("#hl-close-prompt").click((function(){removePrompts()}))}function removePrompts(){jQuery(".hl-prompt").each((function(){jQuery(this).remove()}))}function insertPassword(password_input){chrome.runtime.sendMessage({message:"check_devtools_open"},(function(response){if(response.count>0)insertPromptExternalExams("DevTools Open","Tampering with the password module is prohibited. Your instructor will be notified.");else{if(jQuery(password_inputs).length<1){password_input=jQuery(".hl-lock-selected");password_input.addClass("hl-selected-found")}else password_input=jQuery(password_input);password_input.val("");password_input.removeClass("hl-active-password");password_input.addClass("hl-lock-square");chrome.runtime.sendMessage({message:"external_exam_exit_listener"},(function(response){password_input.val("");loadingPassword()}));var count=1;function loadingPassword(){if(count>14)passwordReady();else{password_input.val(randomString(count));count++;setTimeout((function(){loadingPassword()}),100)}}function passwordReady(){setTimeout((function(){if(password_input.val()!=access_code){password_input.val("");password_input.val(access_code);password_input[0]?.dispatchEvent(new Event("input",{bubbles:true}));password_input.addClass("hl-insert-append");appendScript(appendSrc).then((()=>{if(password_input.val()==access_code){let dummy_password_input=replacePasswordWithDummy(password_input);dummy_password_input.addClass("hl-lock-selected");dummy_password_input.addClass("hl-lock-square");if(demo_mode<1){password_insert_success++;chrome.runtime.sendMessage({message:"password_insert_success",host:window.location.hostname});chrome.storage.local.set({password_insert_url:window.location.href})}}else insertPromptExternalExams("Error","Unable to set the password field")})).catch((()=>insertPromptExternalExams("Error","Unable to set the password field")))}}),500)}}}))}function randomString(len){var outStr="",newStr;while(outStr.length<len){newStr=Math.random().toString(36).slice(2);outStr+=newStr.slice(0,Math.min(newStr.length,len-outStr.length))}return outStr.toLowerCase()}function appendScript(src){return new Promise(((resolve,reject)=>{let script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",src);script.onload=()=>{script.remove();resolve()};script.onerror=reject;(document.head||document.documentElement).appendChild(script)}))}function replacePasswordWithDummy(password_field){password_field.after('<div id="honorlock_password_field" />');let field_styles=window.getComputedStyle(password_field[0]);let new_password_field=$("#honorlock_password_field");Array.from(field_styles).forEach((key=>new_password_field[0].style.setProperty(key,field_styles.getPropertyValue(key),field_styles.getPropertyPriority(key))));password_field.attr("type","hidden");new_password_field.text(randomString(14));return new_password_field}function resetDummyPasswordField(){password_inputs.toArray().forEach((input=>{let password_input=$(input);password_input.addClass("hl-insert-append");appendScript(appendSrc).then((()=>{password_input.attr("type","password");$("#honorlock_password_field").remove()}))}))}