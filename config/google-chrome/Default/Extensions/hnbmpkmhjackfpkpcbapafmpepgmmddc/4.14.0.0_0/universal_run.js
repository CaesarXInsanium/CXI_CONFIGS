chrome.runtime.sendMessage({message:"get_internal_whitelist"},(response=>{const needle=response.result.find((whitelist_url=>response.sender.includes(whitelist_url)));if(!needle)init()}));function init(){try{chrome.storage.local.get(null,(function(result){const examData=result.hasOwnProperty("launch_meta")?result.launch_meta:result;const lmsId=parseInt(examData.lms_id);const isUniversalExam=5===lmsId;const examState=result.exam_state;const requiredExamStates=["prelaunch","active","paused"];let translations=examData.translations;if(isUniversalExam&&"object"===typeof hlExamTools&&requiredExamStates.includes(examState)){const examUrl=result.password_insert_url||examData.exam_url;const appUrl=examData.app_url;const isDisableCopyPasteActive=1===parseInt(examData.is_disable_copy_paste_active);const isRecordWebcamActive=1===parseInt(examData.is_record_webcam_active);setupUniversalExam(examUrl,appUrl,isDisableCopyPasteActive,isRecordWebcamActive,translations);return}if("object"===typeof hlExamTools)hlExamTools.disableBrowserGuardUI()}))}catch(e){if("object"===typeof hlExamTools)hlExamTools.disableBrowserGuardUI();void 0}function setupUniversalExam(examUrl,appUrl,isDisableCopyPasteActive,isRecordWebcamActive,translations){const examUrlElem=examUrl?new URL(hlExamTools.checkValidUrl(examUrl)):"";const isOverlayOnly=examUrlElem?-1===window.location.href.indexOf(examUrlElem.host):false;insertExamTools();setupUniversalExamListeners();setupBrowserGuardListeners();if(isDisableCopyPasteActive){if("loading"!==document.readyState){trackDisabledEvents();return}window.addEventListener("load",trackDisabledEvents)}function insertExamTools(){hlExamTools.init({environmentUrl:appUrl,activeLms:"universal",isOverlayOnly:isOverlayOnly,isUniversalExam:true,isExamUsingWebcam:!isOverlayOnly&&isRecordWebcamActive,translations:translations})}function showCalculator(calculatorType){if(!isOverlayOnly)hlExamTools.proctorAddCalculatorToExam(calculatorType)}function hideCalculator(){if(!isOverlayOnly)hlExamTools.proctorRemoveCalculatorFromExam()}function toggleCalculator(setActiveState=null,forceFocus=true){if(!isOverlayOnly)hlExamTools.toggleCalculator(setActiveState,forceFocus)}function trackDisabledEvents(){chrome.runtime.sendMessage({message:"start_disable_copy_paste"});if("undefined"!==typeof hlAlert)hlAlert.init()}function toggleWebcamVisibilty(shouldBeVisible){if("object"===typeof hlExamTools)hlExamTools.toggleWebcam(shouldBeVisible)}function toggleWebcamCompressed(shouldBeCompressed){if("object"===typeof hlExamTools)hlExamTools.toggleWebcamCompressed(shouldBeCompressed)}function setupUniversalExamListeners(){const onMessageFunctions={showcalculator:()=>{showCalculator("basic")},showcalculatorsci:()=>{showCalculator("scientific")},hidecalculators:()=>{hideCalculator()},opencalculator:()=>{toggleCalculator(true,true)},opencalculatorsci:()=>{toggleCalculator(true,true)},closecalculators:()=>{toggleCalculator(false,false)},init_browser_guard:()=>{chrome.runtime.sendMessage({message:"begin_fullscreen"})},disable_universal_toolbar:()=>{if("object"===typeof hlExamTools)hlExamTools.removeExamTools()},show_blocked_event_notification:message=>{hlAlert.showAlert("exam",`${message.event_name} is not permitted.`,null,{timeout:3e3})},showwebcam:()=>{toggleWebcamVisibilty(true)},hidewebcam:()=>{toggleWebcamVisibilty(false)},compresswebcam:()=>{toggleWebcamCompressed(true)},expandwebcam:()=>{toggleWebcamCompressed(false)}};chrome.extension.onMessage.addListener((function(message){if(onMessageFunctions[message.action])onMessageFunctions[message.action](message)}))}function setupBrowserGuardListeners(){if("object"===typeof hlIdleBrowserCapture&&!isOverlayOnly)hlIdleBrowserCapture.init({translations:translations});chrome.runtime.sendMessage({message:"inject_shortcut_detection",type:"browser_guard"})}}}