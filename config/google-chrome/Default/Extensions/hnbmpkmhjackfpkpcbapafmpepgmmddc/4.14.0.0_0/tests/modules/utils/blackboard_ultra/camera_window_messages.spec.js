chrome.extension=chrome.runtime;global.$=require("../../../../jquery-3.1.0.min.js");require("../../../../modules/utils/blackboard_ultra/camera_window_messages");require("../../../../modules/utils/blackboard_ultra/initialize_exam");require("../../../../modules/utils/blackboard_ultra/wait_for_first_question");describe("checklist complete action message",(()=>{beforeEach((()=>{document.body.innerHTML=`\n          <iframe id="lti-launch-iframe"></iframe>\n        `;jest.clearAllMocks()}));it("Will wait for first question when checklist completes and start exam pending is true",(async()=>{getActiveLmsExamId=jest.fn((async()=>42));waitForFirstQuestion=jest.fn();startExamPending=true;examWasStarted=false;document.getElementById("lti-launch-iframe").contentWindow.postMessage=jest.fn();await cameraWindowMessages({action:"checklist_complete"});expect(document.getElementById("lti-launch-iframe").contentWindow.postMessage).toBeCalledWith({checklistComplete:true},"*");expect(examWasStarted).toBe(true);expect(startExamPending).toBe(false);expect(waitForFirstQuestion).toBeCalledWith(initializeExam)}));it("will not wait for first question if active lms examId is not present",(async()=>{getActiveLmsExamId=jest.fn((async()=>{}));startExamPending=true;examWasStarted=false;waitForFirstQuestion=jest.fn();await cameraWindowMessages({action:"checklist_complete"});expect(waitForFirstQuestion).not.toBeCalled();expect(startExamPending).toBe(true);expect(examWasStarted).toBe(false)}));it("will not wait for first question if start exam pending is false",(async()=>{getActiveLmsExamId=jest.fn((async()=>42));startExamPending=false;examWasStarted=false;waitForFirstQuestion=jest.fn();await cameraWindowMessages({action:"checklist_complete"});expect(waitForFirstQuestion).not.toBeCalled();expect(startExamPending).toBe(false);expect(examWasStarted).toBe(false)}));it("will not wait for first question if exam was already started",(async()=>{getActiveLmsExamId=jest.fn((async()=>42));startExamPending=true;examWasStarted=true;waitForFirstQuestion=jest.fn();await cameraWindowMessages({action:"checklist_complete"});expect(waitForFirstQuestion).not.toBeCalled();expect(startExamPending).toBe(true);expect(examWasStarted).toBe(true)}));it("Will focus page when camera blade checklist_complete message is received",(async()=>{await cameraWindowMessages({action:"checklist_complete"});expect(chrome.runtime.sendMessage).toHaveBeenCalledWith({message:"focus_page"})}));it("Will not handle checklist complete message if classic view",(async()=>{document.body.innerHTML=`\n            <iframe class="classic-learn-iframe"></iframe>\n        `;document.getElementById=jest.fn();await cameraWindowMessages({action:"checklist_complete"});expect(document.getElementById).not.toBeCalledWith("lti-launch-iframe")}))}));