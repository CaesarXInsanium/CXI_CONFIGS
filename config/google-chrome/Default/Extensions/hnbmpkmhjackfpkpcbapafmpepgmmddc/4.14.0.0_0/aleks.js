var heading,subheading,password,password_div,current_page,page_identified,student_name,student_firstname,student_email,student_username,hashed_username,school_name,domain_name,cohort_name,class_name,placementFlagProctored,current_attempt,max_attempts,isProctored,exam_toggles,student_id,session_id,exam_id,log_id,extra_display_count;var submit_timeout=0;var page_detect_retry=0;var checking_webcam=0;var env_grab_attempt=0;var env_check_attempt=0;var ppl_active=0;var enable_debug_log=false;var enable_debug_function=true;var enable_debug_timestamp=true;var enable_debug_env_vars=true;var enable_debug_show_log_callee=true;let translations;let isExamUsingWebcam=false;$(document).ready((function(){checkHash(window.location.hash)}));chrome.runtime.sendMessage({message:"is_exam_paused"},(response=>{if(!!response.student_id)student_id=response.student_id;if(!!response.session_id)session_id=response.session_id;if(!!response.exam_id)exam_id=response.exam_id;if("paused"==response.exam_state)pauseAllTabs(response.pause_reasons)}));function pauseAllTabs(reason,relaunch=false){chrome.runtime.sendMessage({message:"pause_all_tabs",reason:[reason],relaunch:relaunch})}function resumeAllTabs(){setTimeout((function(){chrome.runtime.sendMessage({message:"resume_all_tabs"})}),750)}chrome.extension.onMessage.addListener((function(msg,sender,sendResponse){debug_log("Message received: "+msg.action);if("webcam_open"===msg.action)webcamOpenMessage();if("test_ready"===msg.action)submitAccessCode(msg.data);if("relaunch_webcam"===msg.action)relaunchHandler();if("resume_assessment"===msg.action)resumeAssessment();if("webcam_restarted"===msg.action)setTimeout((function(){checking_webcam=0}),1e3);if("hide_frame"===msg.action){debug_log("Hide frame");if($("#hlframe").length)$("#hlframe").css("display","none")}if("show_frame"===msg.action){debug_log("Show frame");if($("#hlframe").length)$("#hlframe").css("display","inline-block")}if("display_count"==msg.action)extra_display_count=msg.data-1;if("checklist_complete"==msg.action){var data={lms_id:3,exam_id:exam_id,student_id:student_id,session_id:session_id,student_username:student_username,hu:hashed_username,cohort_name:cohort_name,class_name:class_name};sendResponse(data)}if("open_support_chat"===msg.action){hlChat.destroy();hlChat.setGroupId(msg.group_id);hlChat.injectCode();hlChat.maximizeWindow()}if("show_exam_webcam"===msg.action)insertExamTools(isExamUsingWebcam)}));window.addEventListener("message",(function(e){debug_log("addEventListener: "+e.data);if("honorframe_ready"==e.data)insertSurveyLogic()}));$(window).on("hashchange",(function(){checkHash(window.location.hash);debug_log(window.location.hash)}));function checkHash(hash){debug_function();debug_log("Checkhash: "+hash);if(!hash){debug_log("Empty hash");detectPage();hideLiveChat();return false}if("#assess_placement"==hash){getEnvInfo((function(isProctoredCallback){tempHideMainContents();detectPage();if(isProctoredCallback)debug_log("isProctoredCallback: "+isProctoredCallback)}));try{homeViewObserver.disconnect()}catch(e){debug_log(e)}}if("#start_survey"==hash)insertSurveyLogic();if("#home"==hash){getEnvInfo();createHomeViewObserver();getEnvInfo((function(isProctoredCallback){detectPage()}))}if("#errorPage"==hash){eraseCookie("hlenv_student_name");eraseCookie("hlenv_student_firstname");eraseCookie("hlenv_student_email");eraseCookie("hlenv_student_username");eraseCookie("hlenv_hashed_username");eraseCookie("hlenv_school_name");eraseCookie("hlenv_domain_name");eraseCookie("hlenv_cohort_name");eraseCookie("hlenv_class_name");eraseCookie("hlenv_max_attempts");eraseCookie("hlenv_placementFlagProctored");eraseCookie("hlenv_current_attempt");eraseCookie("hlenv_isProctored");eraseCookie("hl_cookie_env");void 0;endProctoringSession()}if("#item"==hash){debug_log("On prep page, Honorlock not continuing");return false}if("#assess_placement"!=hash&&"#start_survey"!=hash){hideLiveChat();try{questionObserver.disconnect()}catch(e){}return false}}function relaunchHandler(){debug_function();debug_log("relaunchHandler called");let relaunch_page_identified=null;if(!ppl_active)return false;relaunch_page_identifiers={page_password:$('div.mainview_item_page:contains("Proctor Password Required")').length,page_tutorial:$("div.mainview_item_page:contains(\"Here's an example of what's to come\")").length,page_question:$("#my_iframe_undefined").length};$.each(relaunch_page_identifiers,(function(key,value){if(value>0){relaunch_page_identified=key;debug_log("relaunch_page_identified:"+key)}}));if(relaunch_page_identified){if(0==checking_webcam){openWebcamWindow("relaunch");checking_webcam=1}else debug_log("Already checking if webcam is open. Ignoring relaunch");setTimeout((function(){checking_webcam=0;debug_log("Reset checking_webcam = 0")}),2e3)}else{debug_log("Relaunch msg received, but not on test page. Ignoring relaunch");chrome.runtime.sendMessage({message:"close_webcam",type:"relaunch"})}}function detectPage(){debug_function();debug_log("detectPage called");let pagecount=0;let page_detect_retry=0;let page_identified=null;page_identifiers={page_home:$(".tooltiptarget_home_mainCTA").length||$(".tooltiptarget_home_leftpanel_placementinfo").length,page_password:$('div.mainview_item_page:contains("Proctor Password Required")').length,page_override:$('div.mainview_item_page:contains("Proctor Access Only")').length,page_logout:$('div.mainview_item_page:contains("You have successfully logged out.")').length,page_tutorial:$("div.tooltiptarget_mainview:contains(\"Here's an example of what's to come\")").length,page_question:$("#my_iframe_undefined").length,page_survey:$('#pageHeaderTitleForProgress:contains("Survey")').length,page_results:$('[role="heading"]:contains("Here are your results")').length,page_myclasses:$('.myClassesHeaderSMR:contains("My Classes")').length};$.each(page_identifiers,(function(key,value){if(value>0){pagecount++;page_detect_retry=0;page_identified=key;debug_log("page_identified:"+key)}}));if(pagecount>1)debug_log("Err: More than one page identified, using highest identifier");if(page_identified){if("page_password"==page_identified)if("unknown"==isProctored||!isProctored){debug_log("Password logic passes, but ENV data is not ready yet. Using cookie fallback.");student_name=readCookie("hlenv_student_name");student_firstname=readCookie("hlenv_student_firstname");student_email=readCookie("hlenv_student_email");student_username=readCookie("hlenv_student_username");hashed_username=readCookie("hlenv_hashed_username");school_name=readCookie("hlenv_school_name");domain_name=readCookie("hlenv_domain_name");cohort_name=readCookie("hlenv_cohort_name");class_name=readCookie("hlenv_class_name");max_attempts=readCookie("hlenv_max_attempts");placementFlagProctored=readCookie("hlenv_placementFlagProctored");current_attempt=readCookie("hlenv_current_attempt");isProctored=1;debug_log("Set. isProctored: "+isProctored)}if(isProctored||"page_home"==page_identified){applyPageLogic(page_identified);if("unknown"!=isProctored)envCookieReloadHandler("kill");return true}if(!isProctored)if("page_override"!=page_identified){debug_log("Assessment not proctored, Honorlock not continuing");return false}else{debug_log("Assessment not proctored, but on proctor override page. Continuing.");applyPageLogic(page_identified)}}if(0==pagecount&&page_detect_retry<50)setTimeout((function(){detectPage()}),100);else page_detect_retry=0}function agreementModal(){debug_function();var agreement_overlay='<div id="agreement-overlay" class="modal-overlay"></div>';var agreement_modal='<div id="agreement-modal" class="modal"></div>';var guideline_image_01=chrome.extension.getURL("assets/guideline_nocalculators.png");var guideline_image_02=chrome.extension.getURL("assets/guideline_noheadphones.png");var guideline_image_03=chrome.extension.getURL("assets/guideline_showid.png");var agreement_prompt=`<h1 style="margin-top: 15px;">${translations.aleks.before_you_begin}</h1>\n    <div class="guideline-container">\n        <div class="guideline-div">\n            <img class="guideline-image" src="`+guideline_image_01+`">\n            <span class="guideline-span">${translations.aleks.put_away_calculator}</span>\n            <label class="agreement-label"><input id="checkbox1" class="guideline-box" type="checkbox" name="guideline1" style="outline: 1px solid black;" /><span style="padding-left: 8px !important;">${translations.aleks.i_understand}</span></label>\n        </div>\n        <div class="guideline-div">\n            <img class="guideline-image" src="`+guideline_image_02+`">\n            <span class="guideline-span">${translations.aleks.remove_headphones}</span>\n            <label class="agreement-label"><input id="checkbox2" class="guideline-box" type="checkbox" name="guideline2" style="outline: 1px solid black;" /><span style="padding-left: 8px !important;">${translations.aleks.i_understand}</span></label>\n        </div>\n        <div class="guideline-div">\n            <img class="guideline-image" src="`+guideline_image_03+`">\n            <span class="guideline-span">${translations.aleks.photo_id_ready}</span>\n            <label class="agreement-label"><input id="checkbox3" class="guideline-box" type="checkbox" name="guideline3" style="outline: 1px solid black;" /><span style="padding-left: 8px !important;">${translations.aleks.i_understand}</span></label>\n        </div>\n    </div>\n    <div id="agreement-div" style="clear:both; display: inline-block; padding: 20px 30px;">\n         <p style="margin-top:0px;">${translations.aleks.follow_guidelines}</p>\n         <button id="agreement-continue" class="btn-ready btn-waiting">${translations.aleks.continue}</button>\n    </div>`;var close_modal='<span id="cancel-agreement-modal" class="modal-close">x</span>';if(!$("#agreement-overlay").length)$("body").append(agreement_overlay);else $("#agreement-overlay").show();if(!$("#agreement-modal").length)$("body").append(agreement_modal);else $("#agreement-modal").show();$("#agreement-modal").html(close_modal+agreement_prompt);$(".hl-livechat-text").css("color","#FFF");$(":checkbox").change((function(){var checkbox1=$("#checkbox1").prop("checked");var checkbox2=$("#checkbox2").prop("checked");var checkbox3=$("#checkbox3").prop("checked");if(checkbox1&&checkbox2&&checkbox3){$("#checkbox1").attr("disabled",true);$("#checkbox2").attr("disabled",true);$("#checkbox3").attr("disabled",true);$("#agreement-continue").removeClass("btn-waiting")}}));$(".guideline-box").change((function(){$("#textbox1").val($(this).is(":checked"))}));$("#cancel-agreement-modal").click((function(){cancelAgreementModal()}));$("#agreement-continue").click((function(){if(student_id)openWebcamWindow();else studentInit("reinit");agreementContinue()}))}function cancelAgreementModal(){try{$("input[aria-label='Home']").trigger("click")}catch(e){}agreementContinue()}function agreementContinue(){debug_function();const $launchProctoring=$("#hl-acknowledge-agreement-button");$launchProctoring.text(translations.aleks.agreement_continue);$launchProctoring.removeClass("btn-waiting");$(".hl-livechat-text").css("color","#000");if($("#agreement-overlay").length)$("#agreement-overlay").hide();if($("#agreement-modal").length)$("#agreement-modal").hide()}function cancelPauseModal(){try{$("input[aria-label='Home']").trigger("click")}catch(e){}resumeAssessment()}function resumeAssessment(){debug_function();if(!ppl_active)return false;resumeAllTabs()}function envCookieReloadHandler(stage){debug_function();if("start"==stage){debug_log("Invoking reload handler to refresh env data");var envCookieValue=readCookie("hl_aleks_reload");if(null==envCookieValue)void 0;else void 0;envCookieValue++;if(envCookieValue<3){void 0;location.reload()}createCookie("hl_aleks_reload",envCookieValue,7)}else{debug_log("Killing reload handler and erasing cookie");eraseCookie("hl_aleks_reload")}}function applyPageLogic(page){debug_function();switch(page){case"page_question":debug_log("applyPageLogic for: page_question");insertQuestionLogic();break;case"page_tutorial":debug_log("applyPageLogic for: page_tutorial");insertTutorialLogic();break;case"page_password":debug_log("applyPageLogic for: page_password");insertPasswordLogic();break;case"page_results":debug_log("applyPageLogic for: page_results");insertResultsLogic();break;case"page_home":debug_log("applyPageLogic for: page_home");insertHomeLogic();break;case"page_override":debug_log("applyPageLogic for: page_override");insertOverrideLogic();break;case"page_myclasses":debug_log("Nothing to do for: page_myclasses");break;default:debug_log("Unexpected page: "+page)}}function insertSurveyLogic(){void 0;if($("#hlframe").length)$("#hlframe").css("display","none");$('input[aria-label="I\'ve installed the Honorlock extension"]').trigger("click");$('[role="group"]:contains("I\'ve installed the Honorlock extension")').find('label:contains("I need assistance")').parent().hide();var hlSurveryItem=$("label").find('div:contains("I\'ve installed the Honorlock extension")');$(hlSurveryItem).html('<span style="color:green;">âœ”</span> I\'ve installed the Honorlock extension (Autodetected)');$(hlSurveryItem).after('<div style="display: inline-block; width: 100%; font-size: 15px; padding-left: 15px;">For proctoring assistance, contact 1-855-828-4004. Or use our <span id="launch-livechat" style="text-decoration: underline; color: blue; cursor: pointer;">live chat</span>.</div>');$("#launch-livechat").click((function(){insertLiveChat()}))}function insertTutorialLogic(){debug_function();createQuestionObserver();createMainViewObserver();if(0==checking_webcam){debug_log("As part of tutorial logic, checking_webcam.");chrome.runtime.sendMessage({message:"check_webcam"})}debug_log("Sent message: check_webcam")}function insertQuestionLogic(){createQuestionObserver();setTimeout((function(){questionPage()}),500)}function insertPasswordLogic(){debug_function();studentInit();serviceAvailabilityCheck();function studentInit(event){var cohort_id=cohort_name?cohort_name:class_name;var data={lms_id:3,current_attempt:current_attempt,lms_school_id:school_name,lms_exam_id:cohort_id,lms_student_id:student_username,lms_student_email:student_email,lms_student_name:student_name,billable:1,href:window.location.href,user_agent:navigator.userAgent,ext_version:chrome.runtime.getManifest().version,browser_version:getChromeVersion()};chrome.runtime.sendMessage({message:"exam_tab_id"});chrome.runtime.sendMessage({message:"lms_init",data:data},(function(r){if(!r.result){void 0;return}var response=r.response;if(1==response.status){student_id=response.student_id;session_id=response.session_id;exam_id=response.exam_id;ppl_active=1;translations=response.translations;if("reinit"==event)openWebcamWindow();else displayLaunchUI(response.launch_screen);isExamUsingWebcam=1===parseInt(response.exam_toggles[1]["value"]);insertLiveChat()}else{void 0;$("#close-modal").click((function(){$("#hl-error").fadeOut()}))}}))}function displayLaunchUI(launchScreen){hideSubmit();var password_page_heading=$("div.mainview_item_page").find('div[role="heading"]:contains("Proctor Password Required")');var password_page_subheading=$(password_page_heading).next();var password_page_subtext=$(password_page_subheading).nextAll().eq(2);if(-1!==$(password_page_subtext).text().indexOf("Don't know the password for this Placement Assessment? Please contact your institution."))$(password_page_subtext).hide();else $("div.mainview_item_page > div > div > div").find('div:contains("Don\'t know the password for this Placement Assessment? Please contact your institution.")').hide();var password_div=$('input[type="password"]').parents().eq(1);password_div.hide();if(0===$("#hl-heading").length){password_page_heading.after(launchScreen);password_page_heading.hide();password_page_subheading.hide()}$("div.mainview_item_page").fadeIn("slow");hlUserAgreement.init(agreementModal,true);hlUserAgreement.setTranslations(translations);chrome.runtime.sendMessage({message:"display_count"})}}function insertHomeLogic(){debug_function();debug_log("On home page, ending any outstanding proctoring session");var homeIsProctored=$('img[src*="ppl_proctored_homepage_icon"]').eq(0).closest('div:contains("Proctored")');var homeIsUnproctored=$('img[src*="ppl_proctored_homepage_icon"]').eq(0).closest('div:contains("Unproctored")');var homeIsCompleted=$("div.tooltiptarget_homepage").find(':contains("All Placement Assessments have been completed.")').length;isProctored=$(homeIsUnproctored).length?false:true;if(isProctored&&0==homeIsCompleted)try{if("Honorlock "!=$(homeIsProctored).html().substring(0,10))$(homeIsProctored).prepend("Honorlock ")}catch(e){void 0}var attemptElement=jQuery("div.tooltiptarget_home_leftpanel_placementinfo > div > div")[0];if(attemptElement){var attemptInfo=attemptElement.innerHTML;if(attemptInfo.includes("Attempt:")){var firstSplit=attemptInfo.split(":");var attempts=firstSplit[1].split("of");current_attempt=parseInt(attempts[0]);max_attempts=parseInt(attempts[1])}}else if("Unproctored"==jQuery('div.tooltiptarget_home_actiontile > span:contains("Unproctored")').text())isProctored=false;else{var env_nav_home=$("#hlock_env_nav_home").text();var hlenv=jQuery.parseJSON(env_nav_home);if(hlenv.args&&hlenv.args.placementActionTile){max_attempts=hlenv.args.placementActionTile.maxAttempt;placementFlagProctored=hlenv.args.placementActionTile.placementFlagProctored;current_attempt=hlenv.args.placementActionTile.currentAttempt;if(current_attempt)isProctored=hlenv.args.placementActionTile.placementInfoPopup.studentAssessmentListWithEndDates[current_attempt-1].isProctored}else if(isProctored){$('input[aria-label="Proctored"]').trigger("click");jQuery('input[value="alertBtn1"]').trigger("click");var attempts=$('div[aria-labelledby="proctorInfoPopupTitle"] > div > div > table > tbody > tr');max_attempts=attempts.length;attempts.each((function(index){var attempt_info=this.innerText;var available_index=attempt_info.indexOf("Available");var in_progress_index=attempt_info.indexOf("In Progress");if(available_index>=0||in_progress_index>=0){current_attempt=attempt_info.substring(0,available_index>in_progress_index?available_index:in_progress_index);return false}}))}}sessionStorage.setItem("isProctored",isProctored);sessionStorage.setItem("current_attempt",current_attempt);sessionStorage.setItem("max_attempts",max_attempts)}function insertResultsLogic(){debug_function();debug_log("On results page, ending proctoring session");postLog("Exam Submit","",false);void 0;let cookie_current_attempt=readCookie("hlenv_current_attempt");void 0;cookie_current_attempt++;void 0;current_attempt=cookie_current_attempt;eraseCookie("hlenv_current_attempt");createCookie("hlenv_current_attempt",cookie_current_attempt,7);endProctoringSession()}function insertOverrideLogic(){debug_function();var override_page_heading=$("div.mainview_item_page").find('div[role="heading"]:contains("Proctor Access Only")');var override_page_subheading=$(override_page_heading).next();var password_div=$('input[type="password"]').parents().eq(1);$("div.mainview_item_page").fadeIn("slow");if(0==$("#hl-subheading").length){$(override_page_heading).after(`<div id="hl-heading" aria-level="1" style="font-size: 20px; color: rgb(0, 50, 65); font-weight: bold; -webkit-font-smoothing: antialiased; padding-bottom: 20px;">${translations.aleks.school_officials_only}</div>`);$(override_page_subheading).after(`<div id="hl-subheading" style="padding-bottom: 18px; color: rgb(0, 50, 65); line-height: 25px;"><p style="font-weight:600;">${translations.aleks.cannot_override}</p></div>`);$(override_page_heading).hide()}}function endProctoringSession(){chrome.runtime.sendMessage({message:"close_webcam",type:"submit"});debug_log("Closing webcam, livechat, and disconnecting observers");hideLiveChat();removeDisabledCalcIcon();if("object"===typeof hlExamTools)hlExamTools.removeExamTools();try{mainViewObserver.disconnect()}catch(e){}try{questionObserver.disconnect()}catch(e){}}function tempHideMainContents(){debug_function();$("div.mainview_item_page").hide();setTimeout((function(){$("div.mainview_item_page").fadeIn("slow")}),1e3)}function createHomeViewObserver(){var homeViewObserver=new MutationObserver((function(mutations){mutations.forEach((function(mutation){if("popupOverlay"==mutation.target.className)if(mutation.target.clientHeight>0){void 0;var honorlock_info=translations.aleks.camera_required;$('div[role="heading"]:contains("Your Placement Assessments")').siblings('div:contains("Before you begin, the proctor will provide a password")').text(honorlock_info);var non_honorlock_info=translations.aleks.non_honorlock_info;$('div[role="heading"]:contains("Your Placement Assessments")').siblings('div:contains("None of your Placement Assessments require a proctor to be present")').text(non_honorlock_info);$('div[role="heading"]:contains("Your Placement Assessments")').siblings("table").find('div:contains("Proctored*")').text(translations.aleks.honorlock_proctored);$('div[role="heading"]').siblings("table").find('div:contains("-")').parent("td").css("padding-left","70px");$('img[src*="ppl_proctored_green_checkmark"]').parent("td").css("padding-left","70px")}else void 0}))}));homeViewObserver.observe(document,{attributes:true,childList:true,characterData:true,subtree:true})}function createMainViewObserver(){try{mainViewObserver.disconnect()}catch(e){}var target=$(".tooltiptarget_mainview")[0];var mainViewObserver=new MutationObserver((function(mutations){mutations.forEach((function(mutation){if("tooltiptarget_mainview"==mutation.target.className){void 0;detectPage()}}))}));var config={childList:true,characterData:true};mainViewObserver.observe(target,config)}function createQuestionObserver(){try{questionObserver.disconnect()}catch(e){}void 0;var target=$(".tooltiptarget_mainview")[0];var questionObserver=new MutationObserver((function(mutations){mutations.forEach((function(mutation){if("characterData"==mutation.type)questionPage()}))}));var config={childList:true,characterData:true,subtree:true};questionObserver.observe(target,config)}function questionPage(){void 0;getQuestionNumber((function(question_num){void 0;if("Question 1"==question_num)postLog("Load",question_num,true);else postLog("Load",question_num,false)}));if(0==checking_webcam){debug_log("New question displayed, checking if webcam open.");chrome.runtime.sendMessage({message:"check_webcam"})}removeDisabledCalcIcon();setTimeout((function(){isCalculatorVisible()}),2500);setTimeout((function(){isCalculatorVisible()}),5e3);setTimeout((function(){isCalculatorVisible()}),3e4)}function openWebcamWindow(event_type){debug_function();debug_log("Open Webcam Window: "+event_type);if("relaunch"==event_type){pauseAllTabs(translations.webcam.relaunch,true);chrome.runtime.sendMessage({message:"close_webcam",type:"relaunch"})}else chrome.runtime.sendMessage({message:"webcam_launch",url:hl_url+"/webapp/camera",session_id:session_id,lms_id:3,relaunch:0,display_count:extra_display_count,current_url:window.location.hostname});window.parent.onbeforeunload=function(){debug_log("onbeforeunload detected, closing webcam");openWebcamWindow("relaunch")}}function getQuestionNumber(callback){let question_num=document.querySelector('[aria-describedBy="progressBarStatus"]').previousElementSibling.textContent;callback(question_num)}function isCalculatorVisible(){var isCalcVisible=$("#togglecalculator").is(":visible");if(!isCalcVisible){void 0;insertDisabledCalcIcon();return false}else{void 0;removeDisabledCalcIcon();return true}}function removeDisabledCalcIcon(){try{$("#hl-disable-calc-tr").remove()}catch(e){}}function insertDisabledCalcIcon(){var hl_calc_disable=`\n        <span id="hl-calculator-disable" style="display: block; position: relative; vertical-align: middle; width: 50px; height: 50px; user-select: none; cursor: not-allowed; outline: black none medium; outline-offset: 0px; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); background-color: rgb(131, 160, 168); margin: 5px; border-radius: 50px;">\n            <div style="float: left; clear: both; position: relative; width: 100%; height: 100%; margin-bottom: 5px;">\n                <div style="float: left; clear: both; position: relative; width: 100%; height: 100%;">\n                    <img src="`+chrome.extension.getURL("assets/icon_disable_calculator.svg")+`" aria-hidden="true" style="width: 50px; height: 50px; display: inline-block;">\n                </div>\n            </div>\n            <div id="calc-tool-tip" style="clear: both; position: relative; width: 100px; height: 35px; font-size: 14px; text-align: center; margin: -35px; padding: 10px; outline: 1px solid orange; display: none; ">\n                <div style="color: black">\n                    ${translations.aleks.no_available_for_question}\n                </div>\n            </div>\n        </span>`;removeDisabledCalcIcon();$("#togglecalculator").closest("tr").after('<tr id="hl-disable-calc-tr"><td style="vertical-align: baseline; text-align: left; font-size: 1em;"></td></tr>');$("#hl-disable-calc-tr").html(hl_calc_disable);$("#hl-calculator-disable").unbind("mouseenter mouseleave");$("#hl-calculator-disable").hover((function(){$("#calc-tool-tip").show()}),(function(){$("#calc-tool-tip").hide()}))}function decryptEnvString(){debug_function();debug_log("env_grab_attempt: "+env_grab_attempt);if(env_grab_attempt>1)return false;if(env_check_attempt>3)return false;try{$("#envtest").remove()}catch(e){}$("body").append(`\n        <script id="envtest" type="text/javascript">\n            if (!document.getElementById("hlock_env")) {\n                var head = document.getElementsByTagName('head').item(0);\n                var hlock_env = document.createElement('div');\n                hlock_env.setAttribute('id', 'hlock_env');\n                head.appendChild(hlock_env);\n\n                var hlock_div = document.getElementById('hlock_env');\n                hlock_div.innerHTML += '<div id="hlock_env_nav_home">'+sessionStorage.getItem('NAV_home')+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_name">'+top.smt.studentInfo.studentName+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_firstname">'+top.smt.studentInfo.firstname+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_email">'+top.smt.studentInfo.email+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_username">'+top.smt.studentInfo.username+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_school_name">'+top.smt.studentInfo.schoolName+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_domain_name">'+top.smt.studentInfo.domainName+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_cohort_name">'+top.smt.studentInfo.cohortName+'</div>';\n                hlock_div.innerHTML += '<div id="hlock_env_class_name">'+top.smt.studentInfo.className+'</div>';\n            }\n        <\/script>\n    `);setTimeout((function(){if($("#hlock_env").length){student_name=$("#hlock_env_name").text();student_firstname=$("#hlock_env_firstname").text();student_email=$("#hlock_env_email").text();student_username=$("#hlock_env_username").text();hashed_username=convert32bitInt(student_username);school_name=$("#hlock_env_school_name").text();domain_name=$("#hlock_env_domain_name").text();cohort_name=$("#hlock_env_cohort_name").text();class_name=$("#hlock_env_class_name").text();env_nav_home=$("#hlock_env_nav_home").text();var sessionFail=false;try{current_attempt=sessionStorage.getItem("current_attempt");max_attempts=sessionStorage.getItem("max_attempts");isProctored="true"==sessionStorage.getItem("isProctored")||"1"==sessionStorage.getItem("isProctored");placementFlagProctored="true"==sessionStorage.getItem("placementFlagProctored")||"1"==sessionStorage.getItem("placementFlagProctored");if("undefined"==isProctored||"unknown"==isProctored||"undefined"==current_attempt)sessionFail=true}catch(e){void 0;sessionFail=true}if(sessionFail){var envFail=false;try{hlenv=jQuery.parseJSON(env_nav_home);max_attempts=hlenv.args.placementActionTile.maxAttempt;placementFlagProctored=hlenv.args.placementActionTile.placementFlagProctored;current_attempt=hlenv.args.placementActionTile.currentAttempt;if(current_attempt){let i=current_attempt-1;isProctored=hlenv.args.placementActionTile.placementInfoPopup.studentAssessmentListWithEndDates[i].isProctored}else envFail=true;try{createCookie("hl_cookie_env","success",7);createCookie("hlenv_student_name",student_name,7);createCookie("hlenv_student_firstname",student_firstname,7);createCookie("hlenv_student_email",student_email,7);createCookie("hlenv_student_username",student_username,7);createCookie("hlenv_hashed_username",hashed_username,7);createCookie("hlenv_school_name",school_name,7);createCookie("hlenv_domain_name",domain_name,7);createCookie("hlenv_cohort_name",cohort_name,7);createCookie("hlenv_class_name",class_name,7);if(max_attempts){createCookie("hlenv_max_attempts",max_attempts,7);createCookie("hlenv_placementFlagProctored",placementFlagProctored,7);createCookie("hlenv_current_attempt",current_attempt,7);createCookie("hlenv_isProctored",isProctored,7)}}catch(e){void 0}}catch(e){void 0;envFail=true}if(envFail){var hl_cookie_env=readCookie("hl_cookie_env");if("success"==hl_cookie_env&&null!=isProctored&&school_name){void 0;try{student_name=readCookie("hlenv_student_name");student_firstname=readCookie("hlenv_student_firstname");student_email=readCookie("hlenv_student_email");student_username=readCookie("hlenv_student_username");hashed_username=readCookie("hlenv_hashed_username");school_name=readCookie("hlenv_school_name");domain_name=readCookie("hlenv_domain_name");cohort_name=readCookie("hlenv_cohort_name");class_name=readCookie("hlenv_class_name");max_attempts=readCookie("hlenv_max_attempts");placementFlagProctored=readCookie("hlenv_placementFlagProctored");current_attempt=readCookie("hlenv_current_attempt");isProctored=readCookie("hlenv_isProctored")}catch(e){void 0}}}}getEnvInfo((function(isProctoredCallback){detectPage();if(isProctoredCallback)debug_log("isProctoredCallback: "+isProctoredCallback)}))}else{void 0;setTimeout((function(){decryptEnvString();env_check_attempt++}),2e3)}}),100)}function getEnvInfo(callback){debug_function();var isReady=$(".mainview_item_page, .tooltiptarget_home_actiontile").eq(0).is(":visible");if(!isReady){setTimeout((function(){getEnvInfo(callback)}),1e3);return false}if(!$("#hlock_env").length){debug_log("hlock_env found");env_grab_attempt++;decryptEnvString();return false}if("undefined"==isProctored){void 0;isProctored="unknown"}if(enable_debug_env_vars)try{debug_log("student_username: "+student_username);debug_log("student_username_32bit: "+convert32bitInt(student_username));debug_log("student_name: "+student_name);debug_log("student_firstname: "+student_firstname);debug_log("student_email: "+student_email);debug_log("school_name: "+school_name);debug_log("domain_name: "+domain_name);debug_log("cohort_name: "+cohort_name);debug_log("class_name: "+class_name);debug_log("Current attempt: "+current_attempt);debug_log("Max attempts: "+max_attempts);debug_log("placementFlagProctored: "+placementFlagProctored);debug_log("isProctored: "+isProctored)}catch(e){void 0}try{callback(isProctored)}catch(e){debug_log(e)}}function debug_function(){if(true===enable_debug_log)try{let first_function,second_function,debug_timestamp;if(arguments.callee.caller.caller.name)first_function=arguments.callee.caller.caller.name+"->";else first_function="";if(arguments.callee.caller.name)second_function=arguments.callee.caller.name+"() ";else second_function="";if(true==enable_debug_timestamp)debug_timestamp=logdate();else debug_timestamp="";void 0}catch(e){void 0}}function debug_log(log){if(true===enable_debug_log)try{let first_function,second_function,debug_timestamp;if(arguments.callee.caller.caller.name)first_function=arguments.callee.caller.caller.name+"->";else first_function="";if(arguments.callee.caller.name)second_function=arguments.callee.caller.name+"() ";else second_function="";if(true==enable_debug_timestamp)debug_timestamp=logdate();else debug_timestamp="";if(true==enable_debug_show_log_callee)void 0;else void 0}catch(e){void 0}else void 0}function insertLiveChat(){const hlChatParameters={lmsSchoolId:school_name,examId:exam_id,studentId:student_id,lmsStudentName:student_name,lmsStudentEmail:student_email,license:livechat_license,withExamTools:true};hlChat.init(hlChatParameters);document.addEventListener("launchcam",(function(){if(student_id)openWebcamWindow();else $("#hl-acknowledge-agreement-button").trigger("click")}));document.addEventListener("relaunchcam",(function(){chrome.runtime.sendMessage({message:"webcam_launch",url:hl_url+"/webapp/camera",session_id:session_id,lms_id:3,relaunch:1,display_count:extra_display_count,current_url:window.location.hostname})}));document.addEventListener("opensesame",(function(){chrome.runtime.sendMessage({message:"bypass_payment"})}));document.addEventListener("focuschat",(function(){chrome.runtime.sendMessage({message:"focus_page"})}));document.addEventListener("nextstep",(function(){chrome.runtime.sendMessage({message:"livechat_command_nextstep"})}));document.addEventListener("cyclevideo",(function(){chrome.runtime.sendMessage({message:"cyclevideo"})}));document.addEventListener("chat-started",(()=>adjustWebcamPositionForChat(true)));document.addEventListener("chat-ended",(()=>adjustWebcamPositionForChat(false)))}function webcamOpenMessage(){debug_function();const hlBeginInstructions=document.getElementById("hl-begin-instructions");hlBeginInstructions.style.display="none";const $hlHeading=$("#hl-heading");$hlHeading.html(`<h2 class="hl-begin-header">${translations.authentication.begin_header}</h2>`);$hlHeading.append(`<div class="hl-subheading">${translations.aleks.begin_instructions}</div>`);$("#relaunch-window").click((function(){$(this).css("color","#540baf");openWebcamWindow()}))}function hideLiveChat(){debug_function();try{$("#hl-livechat").hide()}catch(e){void 0}}function hideSubmit(){debug_function();var submit_button=document.querySelectorAll("button.submitPassword")[0];if("undefined"!=typeof submit_button&&null!=submit_button){submit_button.disabled=true;submit_button.style.cursor="not-allowed";submit_button.style.bottom="-100px";submit_button.style.position="absolute";submit_button.style.pointerEvents="none"}else if(submit_timeout<3){submit_timeout++;setTimeout(hideSubmit,2e3)}}function submitAccessCode(code){debug_function();code=code.substring(0,code.length-2);var access_code=$('input[type="password"]');access_code.val(code);var submit_password=document.querySelectorAll("button.submitPassword")[0];if("undefined"!=typeof submit_password&&null!=submit_password){var exmsg=$("#hl-examstarting");if(exmsg)exmsg[0].style.display="block";setTimeout((function(){if(exmsg)exmsg[0].style.display="none";submit_password.disabled=false;$(".submitPassword").trigger("click")}),4e3)}createQuestionObserver();detectPage()}function logdate(){var date=new Date;var seconds=("0"+date.getSeconds()).slice(-2);var milliseconds=("00"+date.getMilliseconds()).slice(-3);return"|t "+seconds+":"+milliseconds+"| "}function convert32bitInt(str){var hash=0;if(0==str.length)return hash;for(i=0;i<str.length;i++){char=str.charCodeAt(i);hash=(hash<<5)-hash+char;hash&=hash;hash=Math.abs(hash)}return hash}function createCookie(name,value,days){var expires="";if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3);expires="; expires="+date.toUTCString()}document.cookie=name+"="+value+expires+"; path=/"}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(" "==c.charAt(0))c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}function eraseCookie(name){createCookie(name,"",-1)}function studentInit(event){var cohort_id=cohort_name?cohort_name:class_name;var data={lms_id:3,current_attempt:current_attempt,lms_school_id:school_name,lms_exam_id:cohort_id,lms_student_id:student_username,lms_student_email:student_email,lms_student_name:student_name,billable:1,href:window.location.href,user_agent:navigator.userAgent,ext_version:chrome.runtime.getManifest().version,browser_version:getChromeVersion()};chrome.runtime.sendMessage({message:"lms_init",data:data},(function(r){if(r.result){var response=r.response;if(1==response.status){student_id=response.student_id;session_id=response.session_id;exam_id=response.exam_id;translations=response.translations;if("relaunch"==event)openWebcamWindow("relaunch");else openWebcamWindow()}else{void 0;var hl_error_div=`<div id="hl-error" style="position: fixed; top: 30%; left: 50%; width: 480px; padding: 40px 20px; min-height: 260px; background: white; font-size: 20px; box-shadow: 0px 3px 14px rgba(0, 0, 0, 0.33); text-align: center; position: fixed; margin-top: -130px; margin-left: -240px; z-index: 10; display: none;"></div>`;var close_modal=`<span id="close-modal" style="position: absolute; top: 5px; right: 5px; background: rgba(0, 0, 0, 0.05); width: 30px; height: 30px; cursor: pointer;">x</span>`;var updateExtMessage=`<h1>${translations.aleks.extension_update_needed}</h1>\n                    <a href="https://honorlock.com/aleks" target="_blank"><button id="hl-acknowledge-agreement-button" class="btn-ready" style="background-color: #3f51b5;">${translations.aleks.extension_update}</button></a>\n                    <p>${translations.aleks.extension_update_help}</p>`;var universalErrorMessage=`<h1>${translations.aleks.general_error_title}</h1>\n                    <p>${translations.aleks.general_error_body}</p>\n                    <p id="error-msg" style="color: red;display: none">`+response.message+`</p>`;void 0;if(0==$("#hl-error").length)$("body").prepend(hl_error_div);if(response.message==translations.errors.incompatible_version){$("#hl-error").html(updateExtMessage+close_modal);$("#hl-error").show()}else if(response.message==translations.errors.services_unavailable){var unavailable_msg=response.unavailable_msg||null;servicesUnavailable(unavailable_msg)}else{$("#hl-error").html(universalErrorMessage+close_modal);$("#hl-error").show()}$(document).keydown((function(e){if((e.metaKey||e.ctrlKey)&&e.shiftKey&&85==e.keyCode){$("#error-msg").css("display","block");$("#hl-livechat").trigger("click")}}));$("#close-modal").click((function(){$("#hl-error").fadeOut()}))}}else void 0}))}function postLog(event_type,question_num,came_from_launch){var exam_id=cohort_name?cohort_name:class_name;let data={lms_id:3,event_type:event_type,question_num:question_num.trim(),school_identifier:school_name,exam_identifier:exam_id,student_identifier:student_username,user_name:student_name,current_attempt:current_attempt,came_from_launch:came_from_launch,location:window.location.href,hl_student_id:student_id};chrome.runtime.sendMessage({message:"lms_log",data:data})}async function serviceAvailabilityCheck(){var exam_id=cohort_name?cohort_name:class_name;const usat=await getUsat().finally((usat=>usat));jQuery.ajax({url:hl_url+"/webapp/availability",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+usat)},data:{lms_id:3,school_identifier:school_name,exam_identifier:exam_id},type:"POST",async:true,success:function(response){void 0;if(1==response.services_unavailable){var unavailable_msg=response.unavailable_msg||null;servicesUnavailable(unavailable_msg)}}}).fail((function(jQueryXHR,exception){void 0}))}function servicesUnavailable(unavailable_msg){$("#hl-acknowledge-agreement-button").addClass("btn-waiting");var caution_image=chrome.extension.getURL("assets/caution.png");var unavailable_overlay=`<div id="unavailable-overlay" class="modal-overlay"></div>`;var unavailable_modal=`\n        <div id="unavailable-modal" class="modal">\n            <span id="cancel-modal" class="modal-close">x</span>\n            <h1 style="margin-top: 15px;">\n                <img src="`+caution_image+`" style="width: 55px; margin-bottom: -15px;">\n                ${translations.errors.honorlock_unavailable}\n            </h1>\n            <div id="unavailable-div" style="clear:both; display: inline-block; padding: 15px 30px;">\n                 <p id="suspend-message" style="margin-top:0px;"></p>\n                 <p>${translations.aleks.need_help}</p>\n                 <p>${translations.aleks.uninstall}</p>\n            </div>\n        </div>`;if(!$("#unavailable-overlay").length)$("body").append(unavailable_overlay);else $("#unavailable-overlay").show();if(!$("#unavailable-modal").length)$("body").append(unavailable_modal);else $("#unavailable-modal").show();document.getElementById("suspend-message").innerText=unavailable_msg?unavailable_msg:"Honorlock proctoring has been temporarily disabled for this test. Contact your school for alternate proctoring options.";$("#cancel-modal").click((function(){cancelUnavailableModal()}));$("#open-chat").click((function(){void 0;$("#hl-livechat").trigger("click")}));$("#uninstall-link").click((function(){location.reload();chrome.runtime.sendMessage({message:"uninstall_self"})}))}function cancelUnavailableModal(){try{$("input[aria-label='Home']").trigger("click")}catch(e){}unavailableContinue()}function unavailableContinue(){debug_function();$(".hl-livechat-text").css("color","#000");if($("#unavailable-overlay").length)$("#unavailable-overlay").hide();if($("#unavailable-modal").length)$("#unavailable-modal").hide()}function getChromeVersion(){var raw=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return raw?parseInt(raw[2],10):false}function randomString(len){var outStr="",newStr;while(outStr.length<len){newStr=Math.random().toString(36).slice(2);outStr+=newStr.slice(0,Math.min(newStr.length,len-outStr.length))}return outStr.toLowerCase()}function insertExamTools(isExamUsingWebcam){if("object"===typeof hlExamTools)hlExamTools.init({environmentUrl:hl_url,activeLms:"aleks",isExamGuidelinesHidden:true,isExamBegin:true,isExamUsingWebcam:isExamUsingWebcam,translations:translations})}function adjustWebcamPositionForChat(isActive){if("object"===typeof hlExamTools)hlExamTools.adjustWebcamPositionForChat(isActive)}