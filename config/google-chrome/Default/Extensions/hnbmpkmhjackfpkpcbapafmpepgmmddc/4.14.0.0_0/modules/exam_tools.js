class ExamTools{_a11yHelper;_environmentUrl;_studentId;_sessionId;_toolbarData;_availableCalculatorType;_activeLms;_isBrowserGuardActive=false;_isUniversalExam=false;_isOverlayOnly=false;_bodyElement;_initialBodyPadding;_examToolsContainerElement;_isExamToolsMinimized=false;_isChatActive=false;_examToolbarElement;_examToolbarHeight=48;_examToolsMinimizeToggleElement;_examToolsMinimizeToggleTextElement;_examToolsActionsElement;_examToolsMaximizeContainerElement;_examToolsMaximizeButtonElement;_universalExamExitButtonElement;_universalExamChatToggleButtonElement;_calculatorElement;_examToolsDraggablePaneElement;_insertPasswordElementContainer;_insertPasswordElement;_insertPasswordCloseElement;_hasExamPasswordBeenInserted=false;_draggablePaneIntersectionObserver;_expandMinimizedToolbarTimeout;_isExamGuidelinesHidden=false;_dropdownActive=false;_dropdownElement;_dropdownToggleElement;_dropdownSubmenu;_offCanvasDrawerActive=false;_offCanvasDrawerPinned=false;_offCanvasDrawerToggleElement;_offCanvasDrawerToggleTextElement;_offCanvasDrawerElement;_offCanvasDrawerCloseElement;_offCanvasDrawerPinElement;_offCanvasContentContainerElement;_allowedUrls;_offCanvasDrawerAllowedUrlsElement;_allowedApplications;_offCanvasDrawerAllowedApplicationsElement;_offCanvasGuidelinesContainerElement;_isCalculatorActive=false;_isCalculatorCompressed=false;_calculatorToggleElement;_calculatorContainerElement;_calculatorToolbarElement;_calculatorContainerDefaultPosition={top:"15px",left:"15px"};_calculatorContainerPosition;_calculatorCloseElement;_calculatorCompressToggleElement;_calculatorIframeElement;_focusProctorWindowElement;_isExamUsingWebcam=false;_webcam={isExamBegin:false,isActive:true,isCompressed:true,data:null,deviceLabel:null,position:{default:{top:"15px",left:"15px"}},elements:{container:null,beginContent:null,beginButton:null,videoContainer:null,video:null,networkLevel:null,compressToggle:null,closeButton:null,toolbarButton:null}};_examHeadingElement;_defaultExamHeading;_browserGuardHeading="Honorlock Browser Guard<small>â„¢</small>";_eventHandlersMemo={};_icons;_translations;constructor(hlA11yHelper,hlIcons){this._a11yHelper=hlA11yHelper;this._icons={honorlockLogo:hlIcons.honorlockLogo,calculator:hlIcons.examTools.calculator.toolbar,guidelines:hlIcons.examTools.guidelines,support:hlIcons.examTools.support,webcam:hlIcons.examTools.webcam.toolbar,minimizeToolbar:hlIcons.examTools.minimize,offCanvasDrawerPin:hlIcons.examTools.pin,calculatorCompress:hlIcons.examTools.calculator.compress,calculatorExpand:hlIcons.examTools.calculator.expand,dropdown:hlIcons.examTools.dropdown,userShield:hlIcons.examTools.userShield,knowledgeBase:hlIcons.examTools.knowledgeBase,chat:hlIcons.examTools.chat,horizontalDrag:hlIcons.examTools.horizontalDrag,network:hlIcons.examTools.webcam.network,webcamCompress:hlIcons.examTools.webcam.compress,webcamClose:hlIcons.examTools.webcam.close,spinner:hlIcons.examTools.spinner};this._setupChromeRuntimeMessageListener()}async init({environmentUrl:environmentUrl,activeLms:activeLms,isExamBegin:isExamBegin=false,isOverlayOnly:isOverlayOnly=false,isUniversalExam:isUniversalExam=false,isExamGuidelinesHidden:isExamGuidelinesHidden=false,isExamUsingWebcam:isExamUsingWebcam=false,translations:translations}){const existingToolbar=document.getElementById("hl-exam-tools");if(!!existingToolbar){void 0;return}if("object"!==typeof this._a11yHelper){void 0;return}if("object"!==typeof translations){void 0;return}this._translations=translations;this._environmentUrl=environmentUrl;this._activeLms=activeLms;this._webcam.isExamBegin=isExamBegin;this._isOverlayOnly=isOverlayOnly;this._isUniversalExam=isUniversalExam;this._isExamGuidelinesHidden=isExamGuidelinesHidden;this._isExamUsingWebcam=isExamUsingWebcam;const localStorageData=await this._getExamToolbarLocalStorageData();if(localStorageData.bypass_status)return;const examData=localStorageData.hasOwnProperty("launch_meta")?localStorageData.launch_meta:localStorageData;if("object"!==typeof examData.toolbar_data){void 0;return}this._toolbarData=examData.toolbar_data;this._studentId=examData.student_id;this._sessionId=examData.session_id;this._isCalculatorActive=localStorageData.is_calculator_active;this._isExamToolsMinimized=localStorageData.is_exam_tools_minimized;this._hasExamPasswordBeenInserted=localStorageData.has_password_been_inserted;this._isBrowserGuardActive="undefined"!==typeof localStorageData.proctor_toolbar_update_browser_guard_active?localStorageData.proctor_toolbar_update_browser_guard_active:1===parseInt(localStorageData.guardModeStatus);this._availableCalculatorType=localStorageData.proctor_toolbar_update_calculator_type?localStorageData.proctor_toolbar_update_calculator_type:this._toolbarData.available_calculator_type;this._allowedUrls=localStorageData.proctor_toolbar_update_whitelisted_urls?localStorageData.proctor_toolbar_update_whitelisted_urls:this._toolbarData.whitelisted_urls;this._allowedApplications=localStorageData.proctor_toolbar_update_allowed_applications?localStorageData.proctor_toolbar_update_allowed_applications:this._toolbarData.allowed_applications;this._calculatorContainerPosition=localStorageData.toolbar_calculator_position;this._webcam.isActive="undefined"!==typeof localStorageData.is_webcam_active?localStorageData.is_webcam_active:true;this._webcam.isCompressed="undefined"!==typeof localStorageData.is_webcam_compressed?localStorageData.is_webcam_compressed:true;this._webcam.position={...this._webcam.position,...localStorageData.toolbar_webcam_position};this._webcam.deviceLabel=localStorageData.webcam_device_label;this._defaultExamHeading=translations.student_toolbar.exam_in_progress;this._browserGuardHeading=translations.browserguard.heading;this._initExamToolsElements();this._setupEventListeners();this._a11yHelper.applyFocusVisiblePolyfill(this._examToolsContainerElement)}proctorRemoveCalculatorFromExam(shouldUpdateState=true){this._detachCalculatorEventListeners();this._calculatorElement.remove();this._draggablePaneIntersectionObserver.unobserve(this._calculatorToolbarElement);this._calculatorToolbarElement.remove();this._calculatorToggleElement.remove();this._isCalculatorActive=false;this._isCalculatorCompressed=false;this._calculatorContainerElement=null;this._calculatorCloseElement=null;this._calculatorCompressToggleElement=null;if(shouldUpdateState)chrome.storage.local.set({proctor_toolbar_update_calculator_type:null,is_calculator_active:null})}proctorAddCalculatorToExam(availableCalculatorType="basic"){if(this._calculatorElement)this.proctorRemoveCalculatorFromExam(false);this._availableCalculatorType=availableCalculatorType;this._isCalculatorActive=true;const calculatorMarkup=this._createToolbarButtonElement("hl-exam-toolbar-calculator-toggle","hl-exam-toolbar__button",this._translations.calculator,this._icons.calculator,true,"hl-exam-toolbar__text",false,null);this._calculatorToggleElement=(new DOMParser).parseFromString(calculatorMarkup,"text/html").body.firstChild;this._examToolsActionsElement.prepend(this._calculatorToggleElement);this._createCalculatorElement();this._setupCalculatorEventListeners();chrome.storage.local.set({proctor_toolbar_update_calculator_type:availableCalculatorType,is_calculator_active:true})}removeExamTools(){if(this._examToolsContainerElement){this._removeWebcamElement();this._detachEventListeners();this._examToolsContainerElement.remove();if(this._activeLms)this._bodyElement.classList.remove(`hl-exam-tools-initialized--${this._activeLms}`);this._resetBodyPadding(true)}}enableBorderUI(){this._examToolsContainerElement.classList.add("hl-exam-tools--border-ui-active");this._bodyElement.style.paddingTop="7px";this._bodyElement.style.paddingLeft="7px";this._bodyElement.style.paddingRight="7px"}disableBorderUI(){this._examToolsContainerElement.classList.remove("hl-exam-tools--border-ui-active");this._resetBodyPadding()}enableBrowserGuardUI(){if(this._examToolsContainerElement)chrome.storage.local.set({proctor_toolbar_update_browser_guard_active:true},(()=>{this._examHeadingElement.innerHTML=this._browserGuardHeading;this.enableBorderUI()}))}disableBrowserGuardUI(disableBorderUI=true){if(this._examToolsContainerElement)chrome.storage.local.set({proctor_toolbar_update_browser_guard_active:false},(()=>{this._examHeadingElement.innerHTML=this._defaultExamHeading;if(disableBorderUI)this.disableBorderUI()}))}adjustWebcamPositionForChat(isChatActive){this._isChatActive=isChatActive;this._adjustWebcamPositionForChat()}_getPasswordElements(){let passwordElements=document.querySelectorAll("[type=password]");passwordElements=[...passwordElements].filter((x=>x.offsetWidth>0&&x.offsetHeight>0));if(!passwordElements.length){const passwordExceptionsExamUris=["app.edulastic.com"];for(const uri of passwordExceptionsExamUris)if(window.location.href.indexOf(uri)>-1){passwordElements=document.querySelectorAll("input[type=text]");passwordElements=[...passwordElements].filter((field=>field.offsetWidth>0&&field.offsetHeight>0&&field.id.toLowerCase().indexOf("password")>-1||field.className.toLowerCase().indexOf("password")>-1||field.placeholder.toLowerCase().indexOf("password")>-1));break}}return passwordElements}_createInsertPasswordElement(){if(!this._hasExamPasswordBeenInserted&&this._getPasswordElements().length>=1){this._insertPasswordElementContainer=document.createElement("div");this._insertPasswordElementContainer.classList.add("hl-insert-password-prompt");this._insertPasswordCloseElement=document.createElement("button");this._insertPasswordCloseElement.classList.add("hl-insert-password-prompt__close");this._insertPasswordCloseElement.setAttribute("aria-label","Close insert password prompt");this._insertPasswordElement=document.createElement("button");this._insertPasswordElement.classList.add("hl-insert-password-prompt__button");this._insertPasswordElement.innerText=this._translations.student_toolbar.insert_password;this._insertPasswordElement.setAttribute("aria-label",this._translations.student_toolbar.insert_password_click);this._insertPasswordElementContainer.innerHTML=`\n                <div class="hl-insert-password-prompt__heading">\n                    ${this._icons.honorlockLogo}\n                    ${this._translations.student_toolbar.insert_password_click}\n                </div>\n                <p class="hl-insert-password-prompt__description">${this._translations.student_toolbar.insert_password_instructions}</p>    \n            `;this._insertPasswordElementContainer.appendChild(this._insertPasswordCloseElement);this._insertPasswordElementContainer.appendChild(this._insertPasswordElement);this._examToolsContainerElement.prepend(this._insertPasswordElementContainer);this._setupInsertPasswordEventListener();this._setupInsertPasswordCloseListener()}}checkValidUrl(url){if(url&&!url.match(/^[a-z]+:\/\//i))return`https://${url}`;return url}toggleCalculator(setActiveState=null,forceFocus=true){this._toggleCalculator(setActiveState,forceFocus)}toggleWebcam(setActiveState=null){this._toggleWebcam(setActiveState)}toggleWebcamCompressed(setActiveState=null){this._toggleWebcamCompressed(setActiveState)}_initExamToolsElements(){this._bodyElement=document.querySelector("body");this._bodyElement=this._bodyElement?this._bodyElement:document.querySelector("html");this._initialBodyPadding={top:this._bodyElement.style.paddingTop,left:this._bodyElement.style.paddingLeft,right:this._bodyElement.style.paddingRight,bottom:this._bodyElement.style.paddingBottom};this._bodyElement.style.paddingBottom=`${this._examToolbarHeight}px`;this._createExamToolsElement();this._createToolbarElement();if(!this._isOverlayOnly&&!this._isExamGuidelinesHidden&&(this._toolbarData.guidelines_allowed||this._toolbarData.guidelines_not_allowed))this._createOffCanvasDrawerElement();this._createDraggablePaneElement();if(this._examToolsMinimizeToggleElement&&this._isExamToolsMinimized)this._toggleMinimizeExamTools(this._isExamToolsMinimized);if(!this._isUniversalExam||this._isUniversalExam&&this._hasExamPasswordBeenInserted)this._createWebcamElement();if(!this._isOverlayOnly&&this._availableCalculatorType)this._createCalculatorElement();if(this._isBrowserGuardActive)this.enableBrowserGuardUI();if(!this._isBrowserGuardActive&&this._isUniversalExam)this.enableBorderUI();if(this._isUniversalExam)document.addEventListener("DOMContentLoaded",(()=>{this._createInsertPasswordElement()}))}_createExamToolsElement(){this._examToolsContainerElement=document.createElement("div");this._examToolsContainerElement.id="hl-exam-tools";this._examToolsContainerElement.classList.add("hl-exam-tools");if(this._activeLms)this._bodyElement.classList.add(`hl-exam-tools-initialized--${this._activeLms}`);const chatWidgetContainer=document.getElementById("chat-widget-container");if(chatWidgetContainer){chatWidgetContainer.parentNode.insertBefore(this._examToolsContainerElement,chatWidgetContainer);return}this._bodyElement.appendChild(this._examToolsContainerElement)}_createToolbarElement(){const minimizeButtonData=this._buttonDataContainer("hl-exam-toolbar-minimize-toggle","hl-exam-toolbar__button hl-exam-toolbar__minimize-toggle",this._translations.student_toolbar.hide_toolbar,this._icons.minimizeToolbar,"hl-exam-toolbar__text",true);const toolbarButtonData=[this._availableCalculatorType?this._buttonDataContainer("hl-exam-toolbar-calculator-toggle",`hl-exam-toolbar__button ${this._isCalculatorActive?"hl-exam-toolbar__button--active":""}`,this._translations.calculator,this._icons.calculator,"hl-exam-toolbar__text",true):null,!this._isExamGuidelinesHidden&&(this._toolbarData.guidelines_allowed||this._toolbarData.guidelines_not_allowed)?this._buttonDataContainer("hl-exam-toolbar-guidelines-toggle","hl-exam-toolbar__button",this._translations.student_toolbar.guidelines,this._icons.guidelines,"hl-exam-toolbar__text",false,true):null,this._isExamUsingWebcam?this._buttonDataContainer("hl-exam-toolbar-webcam-toggle",`hl-exam-toolbar__button ${this._webcam.isActive?"hl-exam-toolbar__button--active":""}`,this._translations.student_toolbar.your_webcam,this._icons.webcam,"hl-exam-toolbar__text",false):null,this._isUniversalExam?this._buttonDataContainer("hl-exam-toolbar-universal-live-chat-toggle","hl-exam-toolbar__button",this._translations.student_toolbar.chat_support,this._icons.support,"hl-exam-toolbar__text",false):null,minimizeButtonData];const toolbarDropdownItemData=[this._dropdownItemDataContainer("hl-exam-toolbar-proctor-window-focus","hl-exam-toolbar__dropdown-button",this._translations.student_toolbar.proctor_window,this._icons.userShield),this._dropdownItemDataContainer("hl-exam-toolbar-knowledge-base","hl-exam-toolbar__dropdown-link",this._translations.student_toolbar.knowledge_base,this._icons.knowledgeBase,"https://honorlock.kb.help/"),!this._isUniversalExam?this._dropdownItemDataContainer("hl-exam-toolbar-live-chat-toggle","hl-exam-toolbar__dropdown-button",this._translations.student_toolbar.chat_support,this._icons.chat):null];const toolbarMarkup=`\n                <div class="hl-exam-toolbar__left">\n                    ${this._icons.honorlockLogo}\n                    <span \n                        id="hl-exam-toolbar-heading" \n                        class="hl-exam-toolbar__heading"\n                    >\n                        ${this._isBrowserGuardActive?this._browserGuardHeading:this._defaultExamHeading}\n                    </span>\n                </div>\n                <div class="hl-exam-toolbar__right">\n                    ${!this._isOverlayOnly?`\n                            <div \n                                id="hl-exam-toolbar-actions" \n                                class="hl-exam-toolbar__actions"\n                            >\n                                ${toolbarButtonData.map((buttonData=>buttonData?this._createToolbarButtonElement(buttonData.id,buttonData.classItems,buttonData.label,buttonData.svgElement,buttonData.showLabel,buttonData.textClass,buttonData.ariaExpanded,buttonData.linkHref):"")).join("")}\n                            </div>\n                            <div \n                                id="hl-exam-toolbar-dropdown" \n                                class="hl-exam-toolbar__dropdown"\n                            >\n                                ${this._createToolbarButtonElement("hl-exam-toolbar-dropdown-toggle","hl-exam-toolbar__dropdown-toggle",this._translations.student_toolbar.open_dropdown,this._icons.dropdown,false,"",false)}\n                                <div class="hl-exam-toolbar__dropdown-submenu">\n                                    <ul \n                                        id="hl-exam-toolbar-dropdown-submenu" \n                                        class="hl-exam-toolbar__dropdown-items" \n                                        aria-hidden="true" \n                                        tabIndex="0"\n                                    >\n                                        ${toolbarDropdownItemData.map((itemData=>itemData?this._createToolbarDropdownListElement(itemData.buttonId,itemData.buttonClass,itemData.buttonLabel,itemData.svgElement,itemData.linkHref,itemData.removeButton):"")).join("")}\n                                    </ul>\n                                </div>\n                            </div>\n                        `:""}\n                    ${this._isOverlayOnly?this._createToolbarButtonElement(minimizeButtonData.id,minimizeButtonData.classItems,minimizeButtonData.label,minimizeButtonData.svgElement,minimizeButtonData.showLabel,minimizeButtonData.textClass,minimizeButtonData.ariaExpanded,minimizeButtonData.linkHref):""}\n                    ${this._isUniversalExam?`\n                            <button \n                                id="hl-proctoring-exit-trigger" \n                                class="hl-exam-toolbar__button hl-exam-toolbar__button--exit-trigger" \n                                type="button" \n                                aria-label="${this._translations.student_toolbar.exit_honorlock_proctoring}"\n                            >\n                                <span class="hl-exam-toolbar__text">\n                                    ${this._translations.student_toolbar.exit_honorlock}\n                                </span>\n                            </button>\n                        `:""}\n                </div>\n            `;this._examToolbarElement=document.createElement("div");this._examToolbarElement.id="hl-exam-toolbar";this._examToolbarElement.classList.add("hl-exam-toolbar");this._examToolbarElement.innerHTML=toolbarMarkup;this._examToolsContainerElement.appendChild(this._examToolbarElement);this._examToolsActionsElement=document.getElementById("hl-exam-toolbar-actions");this._examHeadingElement=document.getElementById("hl-exam-toolbar-heading");this._webcam.elements.toolbarButton=document.getElementById("hl-exam-toolbar-webcam-toggle");this._focusProctorWindowElement=document.getElementById("hl-exam-toolbar-proctor-window-focus");this._examToolsMinimizeToggleElement=document.getElementById("hl-exam-toolbar-minimize-toggle");this._examToolsMinimizeToggleTextElement=this._examToolsMinimizeToggleElement.querySelector("span");this._dropdownElement=document.getElementById("hl-exam-toolbar-dropdown");this._dropdownToggleElement=document.getElementById("hl-exam-toolbar-dropdown-toggle");this._dropdownSubmenu=document.getElementById("hl-exam-toolbar-dropdown-submenu");this._universalExamExitButtonElement=document.getElementById("hl-proctoring-exit-trigger");this._universalExamChatToggleButtonElement=document.getElementById("hl-exam-toolbar-universal-live-chat-toggle")}_buttonDataContainer=(id,classItems,label,svgElement,textClass,ariaExpanded=null,showLabel=true,linkHref=null)=>({id:id,classItems:classItems,label:label,svgElement:svgElement,textClass:textClass,ariaExpanded:ariaExpanded,showLabel:showLabel,linkHref:linkHref});_dropdownItemDataContainer=(buttonId,buttonClass,buttonLabel,svgElement,linkHref=null,removeButton=false)=>({buttonId:buttonId,buttonClass:buttonClass,buttonLabel:buttonLabel,svgElement:svgElement,linkHref:linkHref,removeButton:removeButton});_createToolbarButtonElement(id,classItems,label,svgElement,showLabel=true,textClass="hl-exam-toolbar__text",ariaExpanded=null,linkHref=null){const formattedHref=linkHref?this.checkValidUrl(linkHref):null;return`\n                ${formattedHref?`\n                        <a \n                            id="${id}" \n                            class="${classItems}" \n                            href="${formattedHref}" \n                            target="_blank" \n                            rel="noopener noreferrer" \n                            aria-label="${label}" \n                            ${null!==ariaExpanded?`aria-expanded=${ariaExpanded}`:""}\n                        >\n                            ${svgElement}\n                            ${showLabel&&label?`<span class="${textClass}">${label}</span>`:""}\n                        </a>\n                    `:`\n                    <button \n                        id="${id}" \n                        class="${classItems}" \n                        aria-label="${label}" \n                        type="button" \n                        ${null!==ariaExpanded?`aria-expanded=${ariaExpanded}`:""}\n                    >\n                        ${svgElement}\n                        ${showLabel&&label?`<span class="${textClass}">${label}</span>`:""}\n                    </button>\n                `}   \n            `}_toggleCreateExamToolsMaximizeButtonElement(isToolbarMinimized){if(!this._examToolsMaximizeContainerElement){this._examToolsMaximizeContainerElement=document.createElement("div");this._examToolsMaximizeContainerElement.id="hl-exam-toolbar-maximize-container";this._examToolsMaximizeContainerElement.classList.add("hl-exam-toolbar-maximize-container");this._examToolsMaximizeContainerElement.innerHTML=`\n                <div class="hl-exam-toolbar-maximize-drag-action">\n                    ${this._icons.horizontalDrag}\n                </div>\n            `;this._examToolsMaximizeButtonElement=document.createElement("button");this._examToolsMaximizeButtonElement.classList.add("hl-exam-toolbar-maximize-button");this._examToolsMaximizeButtonElement.setAttribute("aria-title",this._translations.student_toolbar.expand_toolbar_aria);this._examToolsMaximizeButtonElement.setAttribute("tabindex","0");this._examToolsMaximizeButtonElement.innerHTML=`\n                ${this._icons.honorlockLogo}\n                ${this._translations.student_toolbar.expand_toolbar}\n            `;this._examToolsMaximizeContainerElement.append(this._examToolsMaximizeButtonElement)}if(isToolbarMinimized){this._examToolsDraggablePaneElement.prepend(this._examToolsMaximizeContainerElement);this._setupDragDropElement("maximizeButtonDragDropHandler",this._examToolsDraggablePaneElement,this._examToolsMaximizeContainerElement,[this._examToolsMaximizeButtonElement]);if(this._examToolsMaximizeContainerElement.offsetLeft<=0||this._examToolsMaximizeContainerElement.offsetLeft>=window.innerWidth)this._examToolsMaximizeContainerElement.style.left="0px";this._setupExamToolsMaximizeButtonEventListeners();this._draggablePaneIntersectionObserver.observe(this._examToolsMaximizeContainerElement);return}this._detachExamToolsMaximizeButtonEventListeners();this._draggablePaneIntersectionObserver.unobserve(this._examToolsMaximizeContainerElement);this._examToolsMaximizeContainerElement.remove()}_createToolbarDropdownListElement(buttonId,buttonClass,buttonLabel,svgElement,linkHref=null,removeButton=false){const formattedHref=linkHref?this.checkValidUrl(linkHref):null;return`\n                <li class="hl-exam-toolbar__dropdown-item">\n                    ${removeButton?`${svgElement} <span class="hl-exam-toolbar__dropdown-text">${buttonLabel}</span>`:formattedHref?`\n                                <a \n                                    id="${buttonId}" \n                                    href="${formattedHref}" \n                                    title="${formattedHref}" \n                                    target="_blank" \n                                    rel="noopener noreferrer" \n                                    class="${buttonClass}"\n                                >\n                                    ${svgElement} \n                                    <span class="hl-exam-toolbar__dropdown-text">\n                                        ${buttonLabel}\n                                    </span>\n                                </a>\n                            `:this._createToolbarButtonElement(buttonId,buttonClass,buttonLabel,svgElement,true,"hl-exam-toolbar__dropdown-text")} \n                </li>\n            `}_createOffCanvasDrawerElement(){const stripHTMLTags=htmlString=>htmlString.replace(/(<([^>]+)>)/gi,"");const guidelinesData=[this._toolbarData.guidelines_allowed&&this._toolbarData.guidelines_allowed.length>0?this._guidelinesDataContainer(this._toolbarData.guidelines_allowed,this._translations.student_toolbar.guidelines_allowed,"hl-exam-drawer__container-allowed"):null,this._toolbarData.guidelines_not_allowed&&this._toolbarData.guidelines_not_allowed.length>0?this._guidelinesDataContainer(this._toolbarData.guidelines_not_allowed,this._translations.student_toolbar.guidelines_not_allowed,"hl-exam-drawer__container-not-allowed"):null,this._toolbarData.additional_instructions&&stripHTMLTags(this._toolbarData.additional_instructions)?this._guidelinesDataContainer(this._toolbarData.additional_instructions,this._translations.student_toolbar.additional_instructions,"hl-exam-drawer__container-additional-instructions",false):null];const guidelinesMarkup=guidelinesData.map((markupData=>{if(markupData)return this._createDrawerContainerElement(markupData.containerData,markupData.containerTitle,markupData.additionalClasses,markupData.containerDataIsIterable,markupData.containerId,markupData.createLinks)})).join("");const offCanvasDrawerMarkup=`\n            <div id="hl-exam-drawer-content" class="hl-exam-drawer__content">\n                <button \n                    id="hl-exam-drawer-pin" \n                    class="hl-exam-drawer__pin-button" \n                    aria-label="${this._translations.student_toolbar.pin_guidelines}"\n                >\n                    ${this._icons.offCanvasDrawerPin}\n                </button>\n                <button \n                    id="hl-exam-drawer-close" \n                    class="hl-exam-drawer__close-button" \n                    type="button" \n                    aria-label="${this._translations.student_toolbar.close_guidelines}"\n                >\n                    ${this._translations.student_toolbar.close_guidelines}\n                </button>\n                ${guidelinesMarkup?`\n                        <div \n                            id="hl-exam-off-canvas-drawer-allowed-guidelines" \n                            class="hl-exam-drawer__guidelines"\n                        >\n                            <div class="hl-exam-drawer__heading">\n                                ${this._translations.student_toolbar.guidelines}\n                            </div>\n                            ${guidelinesMarkup}\n                        </div>\n                    `:""}\n            </div>\n        `;this._offCanvasDrawerElement=document.createElement("aside");this._offCanvasDrawerElement.id="hl-exam-off-canvas-drawer";this._offCanvasDrawerElement.classList.add("hl-exam-drawer");this._offCanvasDrawerElement.innerHTML=offCanvasDrawerMarkup;this._offCanvasDrawerElement.setAttribute("tabindex","0");this._offCanvasDrawerElement.setAttribute("aria-hidden","true");this._examToolsContainerElement.appendChild(this._offCanvasDrawerElement);this._offCanvasDrawerToggleElement=document.getElementById("hl-exam-toolbar-guidelines-toggle");this._offCanvasDrawerToggleTextElement=this._offCanvasDrawerToggleElement.querySelector("span");this._offCanvasDrawerElement=document.getElementById("hl-exam-off-canvas-drawer");this._offCanvasDrawerPinElement=document.getElementById("hl-exam-drawer-pin");this._offCanvasDrawerCloseElement=document.getElementById("hl-exam-drawer-close");this._offCanvasContentContainerElement=document.getElementById("hl-exam-drawer-content");this._offCanvasGuidelinesContainerElement=document.getElementById("hl-exam-off-canvas-drawer-allowed-guidelines");this._updateAllowedUrls(this._allowedUrls);this._updateAllowedApplications(this._allowedApplications)}_guidelinesDataContainer=(containerData,containerTitle,additionalClasses,containerDataIsIterable=true,containerId=null,createLinks=false)=>({containerData:containerData,containerTitle:containerTitle,additionalClasses:additionalClasses,containerId:containerId,createLinks:createLinks,containerDataIsIterable:containerDataIsIterable});_createDrawerContainerElement(containerData,containerTitle=null,additionalClasses,containerDataIsIterable=true,containerId=null,createLinks=false){return`\n                <div \n                    ${containerId?`id="${containerId}"`:""}\n                    class="hl-exam-drawer__container ${additionalClasses?additionalClasses:""}">\n                    ${containerTitle?`<div class="hl-exam-drawer__title">${containerTitle}</div>`:""}\n                    ${containerDataIsIterable?`\n                            <ul class="hl-exam-drawer__list">\n                                ${containerData.map((item=>{const formattedHref=createLinks?this.checkValidUrl(item):null;return`\n                                            <li class="hl-exam-drawer__list-item">\n                                                ${createLinks?`<a \n                                                            href="${formattedHref}" \n                                                            title="${formattedHref}" \n                                                            target="_blank" \n                                                            rel="noopener noreferrer nofollow" \n                                                            class="hl-exam-drawer__link"\n                                                        >\n                                                            ${item}\n                                                        </a>`:item}\n                                            </li>\n                                        `})).join("")}\n                            </ul>\n                        `:`\n                            <div class="hl-exam-drawer__text">\n                                ${containerData}\n                            </div>\n                        `}\n                </div>\n            `}_updateAllowedUrls(allowedUrls,shouldUpdateState=false){if(!allowedUrls||!this._offCanvasContentContainerElement)return;if(!this._offCanvasDrawerAllowedUrlsElement){this._offCanvasDrawerAllowedUrlsElement=document.createElement("div");this._offCanvasDrawerAllowedUrlsElement.id="hl-exam-off-canvas-drawer-allowed-urls";this._offCanvasDrawerAllowedUrlsElement.classList.add("hl-exam-drawer__allowed-urls");this._offCanvasContentContainerElement.insertBefore(this._offCanvasDrawerAllowedUrlsElement,this._offCanvasGuidelinesContainerElement)}if(allowedUrls.length<1){this._offCanvasDrawerToggleTextElement.innerText=this._translations.student_toolbar.guidelines;this._offCanvasDrawerAllowedUrlsElement.innerHTML="";this._offCanvasDrawerAllowedUrlsElement.style.display="none";return}const allowedUrlsData=this._guidelinesDataContainer(allowedUrls,null,"hl-exam-drawer__container-allowed-urls",true,"hl-exam-drawer-container-allowed-urls",true);const allowedUrlsMarkup=this._createDrawerContainerElement(allowedUrlsData.containerData,allowedUrlsData.containerTitle,allowedUrlsData.additionalClasses,allowedUrlsData.containerDataIsIterable,allowedUrlsData.containerId,allowedUrlsData.createLinks);this._offCanvasDrawerToggleTextElement.innerHTML=this._translations.student_toolbar.guidelines;this._offCanvasDrawerAllowedUrlsElement.innerHTML=`\n            <div class="hl-exam-drawer__heading hl-exam-drawer__heading-allowed-urls">\n                ${this._translations.student_toolbar.allowed_urls}\n            </div>\n            ${allowedUrlsMarkup}\n        `;this._offCanvasDrawerAllowedUrlsElement.style.display="block";if(shouldUpdateState)chrome.storage.local.set({proctor_toolbar_update_whitelisted_urls:allowedUrls})}_updateAllowedApplications(allowedApplications,shouldUpdateState=false){if(!allowedApplications||!this._offCanvasContentContainerElement)return;if(!this._offCanvasDrawerAllowedApplicationsElement){this._offCanvasDrawerAllowedApplicationsElement=document.createElement("div");this._offCanvasDrawerAllowedApplicationsElement.id="hl-exam-off-canvas-drawer-allowed-applications";this._offCanvasDrawerAllowedApplicationsElement.classList.add("hl-exam-drawer__allowed-applications");this._offCanvasContentContainerElement.insertBefore(this._offCanvasDrawerAllowedApplicationsElement,this._offCanvasGuidelinesContainerElement)}if(allowedApplications.length<1){this._offCanvasDrawerAllowedApplicationsElement.innerHTML="";this._offCanvasDrawerAllowedApplicationsElement.style.display="none";return}const allowedApplicationsData=this._guidelinesDataContainer(allowedApplications,null,"hl-exam-drawer__container-allowed-applications",true,"hl-exam-drawer-container-allowed-applications");const allowedApplicationsMarkup=this._createDrawerContainerElement(allowedApplicationsData.containerData,allowedApplicationsData.containerTitle,allowedApplicationsData.additionalClasses,allowedApplicationsData.containerDataIsIterable,allowedApplicationsData.containerId);this._offCanvasDrawerAllowedApplicationsElement.innerHTML=`\n            <div class="hl-exam-drawer__heading hl-exam-drawer__heading-allowed-applications">\n                ${this._translations.student_toolbar.allowed_applications}\n            </div>\n            ${allowedApplicationsMarkup}\n        `;this._offCanvasDrawerAllowedApplicationsElement.style.display="block";if(shouldUpdateState)chrome.storage.local.set({proctor_toolbar_update_allowed_applications:allowedApplications})}_createDraggablePaneElement(){this._examToolsDraggablePaneElement=document.createElement("div");this._examToolsDraggablePaneElement.id="hl-exam-draggable-pane";this._examToolsDraggablePaneElement.classList.add("hl-exam-draggable-pane");this._examToolsContainerElement.prepend(this._examToolsDraggablePaneElement);const observerOptions={root:this._examToolsDraggablePaneElement,rootMargin:"0px",threshold:0};this._draggablePaneIntersectionObserver=new IntersectionObserver(this._handleDraggablePaneIntersect,observerOptions)}_handleDraggablePaneIntersect=entries=>{entries.forEach((entry=>{if(entry.intersectionRatio<=0){const target=entry.target;if("hl-exam-calculator-toolbar"===target.id&&this._isCalculatorActive&&this._calculatorElement){this._calculatorElement.style.top=this._calculatorContainerDefaultPosition.top;this._calculatorElement.style.left=this._calculatorContainerDefaultPosition.left;chrome.storage.local.set({toolbar_calculator_position:{top:this._calculatorContainerDefaultPosition.top,left:this._calculatorContainerDefaultPosition.left}});return}if("hl-exam-toolbar-maximize-container"===target.id&&this._isExamToolsMinimized&&this._examToolsMaximizeContainerElement){this._examToolsMaximizeContainerElement.style.left="0px";return}if("hl-exam-webcam"===target.id&&this._webcam.isActive&&this._webcam.elements.container){this._webcam.elements.container.style.top=this._webcam.position.default.top;this._webcam.elements.container.style.left=this._webcam.position.default.left;chrome.storage.local.set({toolbar_webcam_position:{...this._webcam.position,top:this._webcam.position.default.top,left:this._webcam.position.default.left}})}}}))};_removeInsertPasswordContainerFromDom(){this._detachInsertPasswordEventListener();if(this._insertPasswordElementContainer)this._insertPasswordElementContainer.remove();chrome.storage.local.set({has_password_been_inserted:true})}_createCalculatorElement(){const calculatorToolbarMarkup=`\n            <div \n                id="hl-exam-calculator-toolbar" \n                class="hl-exam-calculator__toolbar"\n            >\n                <div class="hl-exam-calculator__toolbar-title">\n                    ${this._icons.honorlockLogo}\n                    ${"basic"===this._availableCalculatorType?this._translations.calculator:this._translations.scientific_calculator}\n                </div>\n                <button \n                    id="hl-exam-calculator-compress-toggle" \n                    class="hl-exam-calculator__compress-button" \n                    aria-label="${this._translations.student_toolbar.compress_calculator}"\n                >\n                    ${this._icons.calculatorCompress}\n                </button>\n                <button \n                    id="hl-exam-calculator-close" \n                    class="hl-exam-calculator__close-button" \n                    aria-label="${this._translations.student_toolbar.close_calculator}"\n                >\n                    ${this._translations.student_toolbar.close_calculator}"\n                </button>\n            </div>\n        `;this._calculatorIframeElement=document.createElement("iframe");this._calculatorIframeElement.src="basic"===this._availableCalculatorType?`${this._environmentUrl}/calc`:`${this._environmentUrl}/calc/scientific`;this._calculatorIframeElement.style.width="basic"===this._availableCalculatorType?"342px":"645px";this._calculatorIframeElement.style.height="395px";this._calculatorIframeElement.classList.add("hl-exam-calculator__iframe");this._calculatorContainerElement=document.createElement("div");this._calculatorContainerElement.id="hl-exam-calculator-container";this._calculatorContainerElement.classList.add("hl-exam-calculator__container");this._calculatorContainerElement.appendChild(this._calculatorIframeElement);this._calculatorElement=document.createElement("div");this._calculatorElement.id="hl-exam-calculator";this._calculatorElement.classList.add("hl-exam-calculator");if(this._isCalculatorActive)this._calculatorElement.classList.add("hl-exam-calculator--active");this._calculatorElement.innerHTML=calculatorToolbarMarkup;this._calculatorContainerDefaultPosition.left=`calc(100% - ${this._calculatorIframeElement.style.width} - 30px)`;this._calculatorElement.style.top=this._calculatorContainerPosition&&this._calculatorContainerPosition.top?this._calculatorContainerPosition.top:this._calculatorContainerDefaultPosition.top;this._calculatorElement.style.left=this._calculatorContainerPosition&&this._calculatorContainerPosition.left?this._calculatorContainerPosition.left:this._calculatorContainerDefaultPosition.left;this._calculatorElement.setAttribute("aria-hidden","false");this._calculatorElement.appendChild(this._calculatorContainerElement);this._examToolsDraggablePaneElement.appendChild(this._calculatorElement);this._calculatorToggleElement=document.getElementById("hl-exam-toolbar-calculator-toggle");this._calculatorCloseElement=document.getElementById("hl-exam-calculator-close");this._calculatorCompressToggleElement=document.getElementById("hl-exam-calculator-compress-toggle");this._setupDragDropElement("calculatorDragDropHandler",this._examToolsDraggablePaneElement,this._calculatorElement,[this._calculatorContainerElement,this._calculatorCloseElement,this._calculatorCompressToggleElement,this._calculatorIframeElement],(elementPosition=>{this._calculatorContainerPosition=elementPosition;chrome.storage.local.set({toolbar_calculator_position:this._calculatorContainerPosition})}));this._calculatorToolbarElement=document.getElementById("hl-exam-calculator-toolbar");this._draggablePaneIntersectionObserver.observe(this._calculatorToolbarElement)}_createWebcamElement(){if(!this._isExamUsingWebcam&&!this._webcam.isExamBegin)return;this._webcam.elements.container=document.createElement("div");this._webcam.elements.container.id="hl-exam-webcam";this._webcam.elements.container.classList.add("hl-exam-webcam");if(this._webcam.isActive)this._webcam.elements.container.classList.add("hl-exam-webcam--active");if(this._webcam.isCompressed)this._webcam.elements.container.classList.add("hl-exam-webcam--compressed");if(this._isChatActive)this._adjustWebcamPositionForChat();if(this._webcam.isExamBegin){this._webcam.elements.container.classList.add("hl-exam-webcam--init");this._createExamBeginElement()}this._examToolsDraggablePaneElement.appendChild(this._webcam.elements.container);if(!this._isExamUsingWebcam)return;this._createWebcamVideoElement(this._webcam.isExamBegin);this._setWebcamDefaultPosition();this._webcam.elements.container.style.top=this._webcam.position.top||this._webcam.position.default.top;this._webcam.elements.container.style.left=this._webcam.position.left||this._webcam.position.default.left;this._setupDragDropElement("webcamDragDropHandler",this._examToolsDraggablePaneElement,this._webcam.elements.container,[this._webcam.elements.compressToggle,this._webcam.elements.closeButton,this._webcam.elements.beginButton],(elementPosition=>{if(!this._webcam.isExamBegin){this._webcam.position={...this._webcam.position,...elementPosition};chrome.storage.local.set({toolbar_webcam_position:elementPosition})}}));this._startWebcamVideo(this._webcam.isExamBegin);if("function"===typeof this._draggablePaneIntersectionObserver.observe)this._draggablePaneIntersectionObserver.observe(this._webcam.elements.container)}_createExamBeginElement(){const examBeginContentMarkup=`\n            <header class="hl-exam-webcam__begin-header">\n                <h2 class="hl-exam-webcam__begin-heading">${this._translations.student_toolbar.begin_exam_heading}</h2>\n            </header>\n            <p class="hl-exam-webcam__begin-message">\n                ${this._translations.student_toolbar.begin_exam_message}\n            </p> \n        `;this._webcam.elements.beginButton=document.createElement("button");this._webcam.elements.beginButton.id="hl-exam-begin-button";this._webcam.elements.beginButton.classList.add("hl-exam-webcam__begin-button");this._webcam.elements.beginButton.innerText=this._translations.student_toolbar.begin_exam_button;this._webcam.elements.beginButton.disabled=this._isExamUsingWebcam;this._webcam.elements.beginButton.tabIndex=0;this._webcam.elements.beginContent=document.createElement("div");this._webcam.elements.beginContent.id="hl-exam-begin-content";this._webcam.elements.beginContent.classList.add("hl-exam-webcam__begin-content");this._webcam.elements.beginContent.innerHTML=examBeginContentMarkup;this._webcam.elements.beginContent.appendChild(this._webcam.elements.beginButton);this._webcam.elements.container.appendChild(this._webcam.elements.beginContent)}_createWebcamVideoElement(isExamBegin){const webcamToolbarMarkup=`\n            <div \n                id="hl-exam-webcam-toolbar" \n                class="hl-exam-webcam__toolbar"\n            >\n                <span class="hl-exam-webcam__recording-indicator">${this._translations.student_toolbar.webcam_recording}</span>\n                <span \n                    id="hl-exam-webcam-network-indicator" \n                    class="hl-exam-webcam__network-indicator" \n                    data-network-level="5"\n                >\n                    ${this._icons.network}\n                </span>\n                <button \n                    id="hl-exam-webcam-compress-toggle" \n                    class="hl-exam-webcam__compress-toggle "\n                    aria-label="${this._translations.student_toolbar.webcam_compress_aria}"\n                    ${isExamBegin?"disabled":""}\n                >\n                    ${this._icons.webcamCompress}\n                </button>\n                <button \n                    id="hl-exam-webcam-close" \n                    class="hl-exam-webcam__close" \n                    aria-label="${this._translations.student_toolbar.webcam_close_aria}"\n                    ${isExamBegin?"disabled":""}\n                >\n                    ${this._icons.webcamClose}\n                </button>\n            </div>\n        `;this._webcam.elements.video=document.createElement("video");this._webcam.elements.video.id="hl-exam-webcam-video";this._webcam.elements.video.classList.add("hl-exam-webcam__video");this._webcam.elements.video.setAttribute("autoplay",true);this._webcam.elements.videoContainer=document.createElement("div");this._webcam.elements.videoContainer.id="hl-exam-webcam-video-container";this._webcam.elements.videoContainer.classList.add("hl-exam-webcam__video-container");this._webcam.elements.videoContainer.innerHTML=webcamToolbarMarkup;this._webcam.elements.videoContainer.appendChild(this._webcam.elements.video);this._webcam.elements.container.appendChild(this._webcam.elements.videoContainer);this._webcam.elements.networkLevel=document.getElementById("hl-exam-webcam-network-indicator");this._webcam.elements.compressToggle=document.getElementById("hl-exam-webcam-compress-toggle");this._webcam.elements.closeButton=document.getElementById("hl-exam-webcam-close")}_startWebcamVideo(isExamBegin=false){if(!this._webcam.elements.video)return;chrome.runtime.sendMessage({message:"set_camera_setting_active",url:window.location.href},(()=>{if(!navigator.mediaDevices?.getUserMedia)return;navigator.mediaDevices.enumerateDevices().then((devices=>{const activeVideoInputDevice=devices.filter((el=>"videoinput"===el.kind.toLowerCase()&&el.label.toLowerCase()===this._webcam.deviceLabel?.toLowerCase()))[0];const videoConstraints=activeVideoInputDevice?.deviceId?{video:{deviceId:activeVideoInputDevice.deviceId}}:{video:true};navigator.mediaDevices.getUserMedia(videoConstraints).then((stream=>{this._webcam.elements.video.srcObject=stream;if(isExamBegin)this._webcam.elements.beginButton.disabled=false})).catch((error=>{void 0;this._webcam.elements.beginButton.remove()}))}))}))}_stopWebcamVideo(callback=null){if(!this._webcam.elements.video)return;const streams=this._webcam.elements.video.srcObject;if(!streams)return;const tracks=streams.getTracks();if(!tracks)return;tracks.forEach((track=>{track.stop()}));this._webcam.elements.video.srcObject=null;this._webcam.elements.video=null;if("function"===typeof callback)callback()}_handleUpdateActiveWebcamLabel(deviceLabel){this._webcam.deviceLabel=deviceLabel;this._startWebcamVideo();chrome.storage.local.set({webcam_device_label:deviceLabel})}_setWebcamDefaultPosition(){const leftOffset="intellum"===this._activeLms?120:35;this._webcam.position.default.top=`calc(100%  - ${this._webcam.elements.container.offsetHeight}px - 40px)`;this._webcam.position.default.left=`calc(100%  - ${this._webcam.elements.container.offsetWidth}px - ${leftOffset}px)`}_updateWebcamPosition(){if(!this._isWebcamOutsideWindowBounds()&&!this._isChatActive)return;if(this._isChatActive){this._adjustWebcamPositionForChat();return}this._setWebcamPosition()}_setWebcamPosition(top=null,left=null){this._webcam.elements.container.style.top=top||this._webcam.position.default.top;this._webcam.elements.container.style.left=left||this._webcam.position.default.left;chrome.storage.local.set({toolbar_webcam_position:{top:this._webcam.elements.container.style.top,left:this._webcam.elements.container.style.left}})}_adjustWebcamPositionForChat(){const chatWindowOffset=375;if(!this._webcam.elements.container)return;this._webcam.elements.container.classList.toggle("hl-exam-webcam--chat-active",this._isChatActive);if(this._isChatActive&&this._webcam.isActive&&(this._webcam.elements.container.getBoundingClientRect().right>=window.innerWidth-chatWindowOffset||this._isWebcamOutsideWindowBounds())){const topPosition=`calc(100%  - ${this._webcam.elements.container.offsetHeight}px - 40px)`;const leftPosition=`calc(100%  - ${this._webcam.elements.container.offsetWidth}px - ${chatWindowOffset}px)`;this._setWebcamPosition(topPosition,leftPosition)}}_removeWebcamElement(){if(!this._webcam.elements.container)return;this._stopWebcamVideo((()=>{this._detachWebcamEventListeners();this._webcam.elements.container.remove();this._webcam.elements.container=null;chrome.runtime.sendMessage({message:"clear_active_camera_settings"})}))}_toggleDropdown(setActiveState=null){const dropdownActiveClass="hl-exam-toolbar__dropdown--active";this._dropdownActive=null!==setActiveState?setActiveState:!this._dropdownActive;this._toggleElementActiveState(this._dropdownElement,dropdownActiveClass,this._dropdownActive);this._a11yHelper.toggleElementAccessibilityState(this._dropdownSubmenu,this._dropdownToggleElement,this._dropdownActive)}_toggleOffCanvasDrawer(setActiveState=null,forceFocus=true){const offCanvasDrawerActiveClass="hl-exam-drawer--active";this._offCanvasDrawerActive=null!==setActiveState?setActiveState:!this._offCanvasDrawerActive;this._togglePinnedOffCanvasDrawer(false);this._toggleElementActiveState(this._offCanvasDrawerElement,offCanvasDrawerActiveClass,this._offCanvasDrawerActive);this._toggleElementActiveState(this._offCanvasDrawerToggleElement,"hl-exam-toolbar__button--active",this._offCanvasDrawerActive);this._a11yHelper.toggleElementAccessibilityState(this._offCanvasDrawerElement,this._offCanvasDrawerToggleElement,this._offCanvasDrawerActive,forceFocus)}_togglePinnedOffCanvasDrawer(setPinnedState=null){const offCanvasPinActiveClass="hl-exam-drawer__pin-button--active";this._offCanvasDrawerPinned=null!==setPinnedState?setPinnedState:!this._offCanvasDrawerPinned;this._toggleElementActiveState(this._offCanvasDrawerPinElement,offCanvasPinActiveClass,this._offCanvasDrawerPinned)}_toggleCalculator(setActiveState=null,forceFocus=true){if(this._calculatorToggleElement){const calculatorActiveElement="hl-exam-calculator--active";this._isCalculatorActive=null!==setActiveState?setActiveState:!this._isCalculatorActive;this._toggleCalculatorCompressed(false);this._toggleElementActiveState(this._calculatorElement,calculatorActiveElement,this._isCalculatorActive);this._toggleElementActiveState(this._calculatorToggleElement,"hl-exam-toolbar__button--active",this._isCalculatorActive);this._a11yHelper.toggleElementAccessibilityState(this._calculatorElement,this._calculatorToggleElement,this._isCalculatorActive,false);if(forceFocus)this._calculatorIframeElement.contentWindow.focus();if(this._isCalculatorActive&&this._calculatorElement.offsetLeft<=0||this._calculatorElement.offsetLeft>=window.innerWidth){this._calculatorElement.style.top=this._calculatorContainerDefaultPosition.top;this._calculatorElement.style.left=this._calculatorContainerDefaultPosition.left}chrome.storage.local.set({is_calculator_active:this._isCalculatorActive})}}_toggleCalculatorCompressed(setActiveState=null){const calculatorCompressedClass="hl-exam-calculator__container--compressed";this._isCalculatorCompressed=null!==setActiveState?setActiveState:!this._isCalculatorCompressed;this._calculatorCompressToggleElement.innerHTML=this._isCalculatorCompressed?this._icons.calculatorExpand:this._icons.calculatorCompress;this._toggleElementActiveState(this._calculatorContainerElement,calculatorCompressedClass,this._isCalculatorCompressed)}_toggleWebcam(setActiveState=null){if(!this._webcam.elements.toolbarButton||!this._webcam.elements.closeButton||this._webcam.isExamBegin)return;const webcamActiveClass="hl-exam-webcam--active";this._webcam.isActive=null!==setActiveState?setActiveState:!this._webcam.isActive;this._toggleElementActiveState(this._webcam.elements.container,webcamActiveClass,this._webcam.isActive);this._toggleElementActiveState(this._webcam.elements.toolbarButton,"hl-exam-toolbar__button--active",this._webcam.isActive);this._a11yHelper.toggleElementAccessibilityState(this._webcam.elements.container,this._webcam.elements.toolbarButton,this._webcam.isActive,false);chrome.storage.local.set({is_webcam_active:this._webcam.isActive});if(this._webcam.isActive)this._updateWebcamPosition()}_toggleWebcamCompressed(setActiveState=null){if(!this._webcam.isActive)return;const webcamCompressedClass="hl-exam-webcam--compressed";this._webcam.isCompressed=null!==setActiveState?setActiveState:!this._webcam.isCompressed;this._toggleElementActiveState(this._webcam.elements.container,webcamCompressedClass,this._webcam.isCompressed);this._setWebcamDefaultPosition();chrome.storage.local.set({is_webcam_compressed:this._webcam.isCompressed});this._updateWebcamPosition()}_isWebcamOutsideWindowBounds(){const webcamBounds=this._webcam.elements.container.getBoundingClientRect();const windowInnerWidth=window.innerWidth;return webcamBounds.left<=0||webcamBounds.left>=windowInnerWidth||webcamBounds.right>=windowInnerWidth||webcamBounds.top<=0||webcamBounds.bottom>=window.innerHeight-this._examToolbarHeight}_updateNetworkQualityLevel(level){if(!this._webcam.elements.networkLevel)return;this._webcam.elements.networkLevel.setAttribute("data-network-level",level)}_focusProctorWindow(){chrome.runtime.sendMessage({message:"focus_webcam"})}_toggleMinimizeExamTools(setActiveState=null,forceFocus=true){const examToolsMinimizedClass="hl-exam-tools--minimized";this._isExamToolsMinimized=null!==setActiveState?setActiveState:!this._isExamToolsMinimized;this._examToolsMinimizeToggleTextElement.innerHTML=this._isExamToolsMinimized?this._translations.student_toolbar.expand_toolbar:this._translations.student_toolbar.hide_toolbar;this._toggleElementActiveState(this._examToolsContainerElement,examToolsMinimizedClass,this._isExamToolsMinimized);this._toggleElementActiveState(this._examToolsMinimizeToggleElement,"hl-exam-toolbar__button--active",this._isExamToolsMinimized);this._a11yHelper.toggleElementAccessibilityState(this._examToolbarElement,this._examToolsMinimizeToggleElement,!this._isExamToolsMinimized,forceFocus);this._toggleCreateExamToolsMaximizeButtonElement(this._isExamToolsMinimized);chrome.storage.local.set({is_exam_tools_minimized:this._isExamToolsMinimized});if(this._isExamToolsMinimized){this._setupToolbarEventListeners();return}this._detachToolbarEventListeners()}_clickInsertPassword(){chrome.runtime.sendMessage({message:"insert_password_external",var:{session_id:this._sessionId}})}_toggleElementActiveState(domElement,activeClass,isActive){if(isActive){domElement.classList.add(activeClass);return}domElement.classList.remove(activeClass)}_resetBodyPadding(isRemovingExamTools=false){this._bodyElement.style.paddingTop=this._initialBodyPadding&&this._initialBodyPadding.top?this._initialBodyPadding.top:"initial";this._bodyElement.style.paddingLeft=this._initialBodyPadding&&this._initialBodyPadding.left?this._initialBodyPadding.left:"initial";this._bodyElement.style.paddingRight=this._initialBodyPadding&&this._initialBodyPadding.right?this._initialBodyPadding.right:"initial";if(isRemovingExamTools)this._bodyElement.style.paddingBottom=this._initialBodyPadding&&this._initialBodyPadding.bottom?this._initialBodyPadding.bottom:"initial"}_setupEventListeners(){this._setupDropdownEventListeners();this._setupOffCanvasDrawerEventListeners();this._setupCalculatorEventListeners();this._setupWebcamEventListeners();this._setupFocusProctorWindowEventListeners();this._setupMinimizeToolsEventListeners();this._setupUniversalExamEventListeners();this._setupDocumentEventListeners()}_detachEventListeners(){this._detachToolbarEventListeners();this._detachExamToolsMaximizeButtonEventListeners();this._detachDropdownEventListeners();this._detachOffCanvasDrawerEventListeners();this._detachCalculatorEventListeners();this._detachWebcamEventListeners();this._detachFocusProctorWindowEventListeners();this._detachMinimizeToolsEventListeners();this._detachInsertPasswordEventListener();this._detachInsertPasswordCloseEventListener();this._detachUniversalExamEventListeners();this._detachDocumentEventListeners();if(this._draggablePaneIntersectionObserver)this._draggablePaneIntersectionObserver.disconnect()}_setupChromeRuntimeMessageListener(){const listenerFunctions={update_toolbar_whitelist_urls:()=>{this._updateAllowedUrls(message.data,true)},update_toolbar_allowed_applications:()=>{this._updateAllowedApplications(message.data,true)},password_insert_success:()=>{this._removeInsertPasswordContainerFromDom();if(this._isExamUsingWebcam&&null===this._webcam.elements.container){this._createWebcamElement();this._setupWebcamEventListeners()}},init_browser_guard:()=>{this.enableBrowserGuardUI()},halt_browser_guard:()=>{this.disableBrowserGuardUI(!this._isUniversalExam)},update_network_quality_level:message=>{this._updateNetworkQualityLevel(message.level)},close_webcam:()=>{this._removeWebcamElement()},camera_window_closed:()=>{if(!this._webcam.isExamBegin){this._removeWebcamElement();return}this.removeExamTools()},update_active_webcam_label:message=>{this._handleUpdateActiveWebcamLabel(message.label)},webcam_restarted:()=>{if(this._isExamUsingWebcam&&null===this._webcam.elements.container){this._createWebcamElement();this._setupWebcamEventListeners()}}};chrome.extension.onMessage.addListener((message=>{if(listenerFunctions[message.action])listenerFunctions[message.action](message)}))}_setupToolbarEventListeners(){if(this._examToolbarElement)this._a11yHelper.setupAccessibleTabFocusListener("toolbarTabFocusHandler",this._examToolbarElement,this._onExpandMinimizedToolbarHandler,this._onHideMinimizedToolbarHandler)}_detachToolbarEventListeners(){if(this._examToolbarElement)this._a11yHelper.detachAccessibleTabFocusListener("toolbarTabFocusHandler",this._examToolbarElement,this._onExpandMinimizedToolbarHandler,this._onHideMinimizedToolbarHandler)}_onExpandMinimizedToolbarHandler=()=>{if(this._isExamToolsMinimized){this._examToolsContainerElement.classList.add("hl-exam-tools--toolbar-interaction");this._a11yHelper.toggleElementAccessibilityState(this._examToolbarElement,this._examToolsMinimizeToggleElement,true,true)}};_onHideMinimizedToolbarHandler=()=>{if(this._expandMinimizedToolbarTimeout)clearTimeout(this._expandMinimizedToolbarTimeout);this._expandMinimizedToolbarTimeout=setTimeout((()=>{this._examToolsContainerElement.classList.remove("hl-exam-tools--toolbar-interaction");if(this._isExamToolsMinimized)this._a11yHelper.toggleElementAccessibilityState(this._examToolbarElement,this._examToolsMinimizeToggleElement,false,false)}),1500)};_setupExamToolsMaximizeButtonEventListeners(){if(this._examToolsMaximizeButtonElement)this._a11yHelper.setupAccessibleClickEventListener("examToolsMaximizeButtonHandler",this._examToolsMaximizeButtonElement,this._onExamToolsMaximizeButtonClickHandler)}_detachExamToolsMaximizeButtonEventListeners(){this._a11yHelper.detachAccessibleClickEventListener("examToolsMaximizeButtonHandler",this._examToolsMaximizeButtonElement,this._onExamToolsMaximizeButtonClickHandler);this._detachDragDropEventListeners("maximizeButtonDragDropHandler",this._examToolsDraggablePaneElement,this._examToolsMaximizeContainerElement,[this._examToolsMaximizeButtonElement])}_onExamToolsMaximizeButtonClickHandler=()=>{this._toggleMinimizeExamTools(false,false)};_setupDropdownEventListeners(){if(this._dropdownToggleElement){this._dropdownToggleElement.addEventListener("click",this._onDropdownToggleClickHandler);this._a11yHelper.setupAccessibleTabFocusListener("dropdownTabFocusHandler",this._dropdownSubmenu,this._onDropdownSubmenuFocusInHandler,this._onDropdownSubmenuFocusOutHandler)}}_detachDropdownEventListeners(){if(this._dropdownToggleElement){this._dropdownToggleElement.removeEventListener("click",this._onDropdownToggleClickHandler);this._a11yHelper.detachAccessibleTabFocusListener("dropdownTabFocusHandler",this._dropdownSubmenu,this._onDropdownSubmenuFocusInHandler,this._onDropdownSubmenuFocusOutHandler)}}_onDropdownToggleClickHandler=()=>{this._toggleDropdown(true)};_onDropdownSubmenuFocusInHandler=()=>{if(!this._dropdownActive)this._toggleDropdown()};_onDropdownSubmenuFocusOutHandler=()=>{this._toggleDropdown()};_setupOffCanvasDrawerEventListeners(){if(this._offCanvasDrawerToggleElement){this._a11yHelper.setupAccessibleClickEventListener("offCanvasDrawerToggleHandler",this._offCanvasDrawerToggleElement,this._onOffCanvasDrawerToggleClickHandler);this._a11yHelper.setupAccessibleClickEventListener("offCanvasDrawerPinHandler",this._offCanvasDrawerPinElement,this._onOffCanvasDrawerPinClickHandler);this._a11yHelper.setupAccessibleClickEventListener("offCanvasDrawerCloseHandler",this._offCanvasDrawerCloseElement,this._onOffCanvasDrawerCloseClickHandler);this._a11yHelper.setupAccessibleTabFocusListener("offCanvasTabFocusHandler",this._offCanvasDrawerElement,this._onOffCanvasDrawerFocusInHandler,this._onOffCanvasDrawerFocusOutHandler)}}_detachOffCanvasDrawerEventListeners(){if(this._offCanvasDrawerToggleElement){this._a11yHelper.detachAccessibleClickEventListener("offCanvasDrawerToggleHandler",this._offCanvasDrawerToggleElement,this._onOffCanvasDrawerToggleClickHandler);this._a11yHelper.detachAccessibleClickEventListener("offCanvasDrawerPinHandler",this._offCanvasDrawerPinElement,this._onOffCanvasDrawerPinClickHandler);this._a11yHelper.detachAccessibleClickEventListener("offCanvasDrawerCloseHandler",this._offCanvasDrawerCloseElement,this._onOffCanvasDrawerCloseClickHandler);this._a11yHelper.detachAccessibleTabFocusListener("offCanvasTabFocusHandler",this._offCanvasDrawerElement,this._onOffCanvasDrawerFocusInHandler,this._onOffCanvasDrawerFocusOutHandler)}}_onOffCanvasDrawerToggleClickHandler=event=>{this._toggleOffCanvasDrawer(null,"keypress"===event.type&&!this._offCanvasDrawerActive)};_onOffCanvasDrawerPinClickHandler=()=>{this._togglePinnedOffCanvasDrawer()};_onOffCanvasDrawerCloseClickHandler=()=>{this._toggleOffCanvasDrawer(false);this._offCanvasDrawerCloseElement.blur()};_onOffCanvasDrawerFocusInHandler=()=>{if(!this._offCanvasDrawerActive)this._toggleOffCanvasDrawer(true,false)};_onOffCanvasDrawerFocusOutHandler=()=>{if(!this._offCanvasDrawerPinned)this._toggleOffCanvasDrawer(false,false)};_setupCalculatorEventListeners(){if(this._calculatorToggleElement){this._a11yHelper.setupAccessibleClickEventListener("calculatorToggleHandler",this._calculatorToggleElement,this._onCalculatorToggleClickHandler);this._a11yHelper.setupAccessibleClickEventListener("calculatorCompressToggleHandler",this._calculatorCompressToggleElement,this._onCalculatorCompressToggleClickHandler);this._a11yHelper.setupAccessibleClickEventListener("calculatorCloseHandler",this._calculatorCloseElement,this._onCalculatorCloseClickHandler);this._calculatorIframeElement.addEventListener("mouseenter",this._onCalculatorMouseEnterHandler)}}_detachCalculatorEventListeners(){if(this._calculatorToggleElement){this._a11yHelper.detachAccessibleClickEventListener("calculatorToggleHandler",this._calculatorToggleElement,this._onCalculatorToggleClickHandler);this._a11yHelper.detachAccessibleClickEventListener("calculatorCompressToggleHandler",this._calculatorCompressToggleElement,this._onCalculatorCompressToggleClickHandler);this._a11yHelper.detachAccessibleClickEventListener("calculatorCloseHandler",this._calculatorCloseElement,this._onCalculatorCloseClickHandler);this._calculatorIframeElement.removeEventListener("mouseenter",this._onCalculatorMouseEnterHandler);this._detachDragDropEventListeners("calculatorDragDropHandler",this._examToolsDraggablePaneElement,this._calculatorElement,[this._calculatorContainerElement,this._calculatorCloseElement,this._calculatorCompressToggleElement,this._calculatorIframeElement])}}_onCalculatorToggleClickHandler=()=>{this._toggleCalculator()};_onCalculatorCompressToggleClickHandler=()=>{this._toggleCalculatorCompressed()};_onCalculatorCloseClickHandler=()=>{this._toggleCalculator(false,!this._isCalculatorActive)};_onCalculatorMouseEnterHandler=()=>{this._calculatorIframeElement.contentWindow.focus()};_setupWebcamEventListeners(){if(this._webcam.elements.beginButton)this._a11yHelper.setupAccessibleClickEventListener("webcamBeginButtonElement",this._webcam.elements.beginButton,this._onBeginExamClickHandler);if(this._webcam.elements.toolbarButton)this._a11yHelper.setupAccessibleClickEventListener("webcamToolbarButtonElement",this._webcam.elements.toolbarButton,this._onWebcamToggleClickHandler);if(this._webcam.elements.compressToggle)this._a11yHelper.setupAccessibleClickEventListener("webcamToolbarCompressElement",this._webcam.elements.compressToggle,this._onWebcamCompressToggleClickHandler);if(this._webcam.elements.closeButton)this._a11yHelper.setupAccessibleClickEventListener("webcamCloseButtonElement",this._webcam.elements.closeButton,this._onWebcamCloseClickHandler)}_detachWebcamEventListeners(){if(this._webcam.elements.beginButton)this._a11yHelper.detachAccessibleClickEventListener("webcamBeginButtonElement",this._webcam.elements.beginButton,this._onBeginExamClickHandler);if(this._webcam.elements.toolbarButton)this._a11yHelper.detachAccessibleClickEventListener("webcamToolbarButtonElement",this._webcam.elements.toolbarButton,this._onWebcamToggleClickHandler);if(this._webcam.elements.compressToggle)this._a11yHelper.detachAccessibleClickEventListener("webcamToolbarCompressElement",this._webcam.elements.compressToggle,this._onWebcamCompressToggleClickHandler);if(this._webcam.elements.closeButton)this._a11yHelper.detachAccessibleClickEventListener("webcamCloseButtonElement",this._webcam.elements.closeButton,this._onWebcamCloseClickHandler);if(this._webcam.elements.container)this._detachDragDropEventListeners("webcamDragDropHandler",this._examToolsDraggablePaneElement,this._webcam.elements.container,[this._webcam.elements.compressToggle,this._webcam.elements.closeButton,this._webcam.elements.beginButton])}_onBeginExamClickHandler=async()=>{this._webcam.isExamBegin=false;this._webcam.elements.beginButton.classList.add("hl-exam-webcam__begin-button--clicked");this._webcam.elements.beginButton.disabled=true;this._webcam.elements.beginContent.innerHTML=`\n            <header class="hl-exam-webcam__begin-header">\n                <h2 class="hl-exam-webcam__begin-heading">${this._translations.student_toolbar.begin_exam_launch_heading}</h2>\n            </header>\n            <p class="hl-exam-webcam__begin-message">\n                ${this._translations.student_toolbar.begin_exam_launch_message}\n            </p>\n            ${this._icons.spinner}\n        `;await this._setTimeoutPromise((()=>{chrome.runtime.sendMessage({message:"minimize_proctor_window"})}),3e3);await this._setTimeoutPromise((()=>{this._webcam.elements.container.classList.add("hl-exam-webcam--launching")}),2500);await this._setTimeoutPromise((()=>{this._webcam.elements.beginContent.remove();this._webcam.elements.container.classList.remove("hl-exam-webcam--init","hl-exam-webcam--launching");this._setWebcamDefaultPosition();this._setWebcamPosition();this._toggleWebcam(false);if(this._webcam.elements.compressToggle&&this._webcam.elements.closeButton){this._webcam.elements.compressToggle.disabled=false;this._webcam.elements.closeButton.disabled=false}chrome.runtime.sendMessage({message:"exam_webcam_begin_button_clicked"})}),500)};_onWebcamToggleClickHandler=()=>{this._toggleWebcam()};_onWebcamCloseClickHandler=()=>{this._toggleWebcam(false)};_onWebcamCompressToggleClickHandler=()=>{this._toggleWebcamCompressed()};_setupFocusProctorWindowEventListeners(){if(this._focusProctorWindowElement)this._a11yHelper.setupAccessibleClickEventListener("focusProctorWindowHandler",this._focusProctorWindowElement,this._onFocusProctorWindowHandler)}_detachFocusProctorWindowEventListeners(){if(this._focusProctorWindowElement)this._a11yHelper.detachAccessibleClickEventListener("focusProctorWindowHandler",this._focusProctorWindowElement,this._onFocusProctorWindowHandler)}_onFocusProctorWindowHandler=()=>{this._focusProctorWindow()};_setupMinimizeToolsEventListeners(){if(this._examToolsMinimizeToggleElement)this._a11yHelper.setupAccessibleClickEventListener("minimizeToolsToggleHandler",this._examToolsMinimizeToggleElement,this._onMinimizeToolsClickHandler)}_detachMinimizeToolsEventListeners(){if(this._examToolsMinimizeToggleElement)this._a11yHelper.detachAccessibleClickEventListener("minimizeToolsToggleHandler",this._examToolsMinimizeToggleElement,this._onMinimizeToolsClickHandler)}_onMinimizeToolsClickHandler=()=>{this._toggleMinimizeExamTools()};_setupInsertPasswordEventListener(){if(this._insertPasswordElement)this._a11yHelper.setupAccessibleClickEventListener("clickInsertPasswordHandler",this._insertPasswordElement,this._onClickInsertPasswordHandler)}_detachInsertPasswordEventListener(){if(this._insertPasswordElement)this._a11yHelper.detachAccessibleClickEventListener("clickInsertPasswordHandler",this._insertPasswordElement,this._onClickInsertPasswordHandler)}_onClickInsertPasswordHandler=()=>{this._clickInsertPassword()};_setupInsertPasswordCloseListener(){if(this._insertPasswordCloseElement)this._a11yHelper.setupAccessibleClickEventListener("clickCloseInsertPasswordHandler",this._insertPasswordCloseElement,this._onClickCloseInsertPasswordHandler)}_detachInsertPasswordCloseEventListener(){if(this._insertPasswordCloseElement)this._a11yHelper.detachAccessibleClickEventListener("clickCloseInsertPasswordHandler",this._insertPasswordCloseElement,this._onClickCloseInsertPasswordHandler)}_onClickCloseInsertPasswordHandler=()=>{this._removeInsertPasswordContainerFromDom()};_setupUniversalExamEventListeners(){if(this._universalExamExitButtonElement)this._a11yHelper.setupAccessibleClickEventListener("universalExamExitButton",this._universalExamExitButtonElement,this._onUniversalExamExitButtonClickHandler);if(this._universalExamChatToggleButtonElement)this._a11yHelper.setupAccessibleClickEventListener("universalExamChatButton",this._universalExamChatToggleButtonElement,this._onUniversalExamChatButtonClickHandler)}_detachUniversalExamEventListeners(){if(this._universalExamExitButtonElement)this._a11yHelper.detachAccessibleClickEventListener("universalExamExitButton",this._universalExamExitButtonElement,this._onUniversalExamExitButtonClickHandler);if(this._universalExamChatToggleButtonElement)this._a11yHelper.detachAccessibleClickEventListener("universalExamChatButton",this._universalExamChatToggleButtonElement,this._onUniversalExamChatButtonClickHandler)}_onUniversalExamExitButtonClickHandler=()=>{chrome.runtime.sendMessage({message:"exit_honorlock_clicked"})};_onUniversalExamChatButtonClickHandler=()=>{chrome.runtime.sendMessage({message:"open_support_chat",chat_group:2})};_setupDocumentEventListeners(){document.addEventListener("click",this._onDocumentClickHandler)}_detachDocumentEventListeners(){document.removeEventListener("click",this._onDocumentClickHandler)}_onDocumentClickHandler=event=>{const target=event.target;if(this._dropdownElement&&this._dropdownActive&&!this._dropdownElement.contains(target))this._toggleDropdown(false);if(this._offCanvasDrawerElement&&!this._offCanvasDrawerPinned&&this._offCanvasDrawerActive&&!this._offCanvasDrawerElement.contains(target)&&!this._offCanvasDrawerToggleElement.contains(target))this._toggleOffCanvasDrawer(false)};_setupDragDropElement(memoIndex,containerDomElement,domElement,ignoredDomElementsArray=[],updateStateCallback=null){const elementPositionState={distanceX:domElement.style.left,distanceY:0};domElement.addEventListener("mousedown",this._onMouseDownHandler(`${memoIndex}-mousedown`,containerDomElement,domElement,elementPositionState,ignoredDomElementsArray));containerDomElement.addEventListener("mousemove",this._onMoveHandler(`${memoIndex}-mousemove`,domElement,elementPositionState));containerDomElement.addEventListener("mouseup",this._onUpHandler(`${memoIndex}-mouseup`,containerDomElement,domElement,updateStateCallback));containerDomElement.addEventListener("touchmove",this._onMoveHandler(`${memoIndex}-touchmove`,domElement,elementPositionState))}_detachDragDropEventListeners(memoIndex,containerDomElement,domElement,ignoredDomElementsArray=[]){if(!domElement||!containerDomElement)return;domElement.removeEventListener("mousedown",this._onMouseDownHandler(`${memoIndex}-mousedown`,containerDomElement,domElement,{distanceX:0,distanceY:0},ignoredDomElementsArray));containerDomElement.removeEventListener("mousemove",this._onMoveHandler(`${memoIndex}-mousemove`,domElement,{distanceX:0,distanceY:0}));containerDomElement.removeEventListener("mouseup",this._onUpHandler(`${memoIndex}-mouseup`,containerDomElement,domElement));containerDomElement.removeEventListener("touchmove",this._onMoveHandler(`${memoIndex}-touchmove`,domElement,{distanceX:0,distanceY:0}));const eventMemos=[`${memoIndex}-mousedown`,`${memoIndex}-mousedown-onDown`,`${memoIndex}-mousemove`,`${memoIndex}-mouseup`,`${memoIndex}-touchmove`];for(const memoRef of eventMemos)this._eventHandlersMemo[memoRef]=null}_onMouseDownHandler=(memoIndex,containerDomElement,domElement,elementPositionState,ignoredDomElementsArray)=>this._eventHandlersMemo[memoIndex]||(this._eventHandlersMemo[memoIndex]=event=>{const target=event.target;for(const index in ignoredDomElementsArray){const element=ignoredDomElementsArray[index];if(element instanceof Element&&element.contains(target))return}this._onDownHandler(`${memoIndex}-onDown`,containerDomElement,domElement,elementPositionState)(event)});_onDownHandler=(memoIndex,containerDomElement,domElement,elementPositionState)=>this._eventHandlersMemo[memoIndex]||(this._eventHandlersMemo[memoIndex]=evt=>{evt.preventDefault();let event="touchstart"===evt.type?evt.changedTouches[0]:evt;elementPositionState.distanceX=Math.abs(domElement.offsetLeft-event.clientX);elementPositionState.distanceY=Math.abs(domElement.offsetTop-event.clientY);domElement.style.pointerEvents="none";domElement.classList.add("hl-exam-element--dragging");containerDomElement.style.pointerEvents="initial";containerDomElement.classList.add("hl-exam-draggable-pane--dragging-element")});_onUpHandler=(memoIndex,containerDomElement,domElement,updateStateCallback)=>this._eventHandlersMemo[memoIndex]||(this._eventHandlersMemo[memoIndex]=()=>{domElement.style.pointerEvents="initial";domElement.classList.remove("hl-exam-element--dragging");containerDomElement.style.pointerEvents="none";containerDomElement.classList.remove("hl-exam-draggable-pane--dragging-element");if(updateStateCallback)updateStateCallback({top:domElement.style.top,left:domElement.style.left})});_onMoveHandler=(memoIndex,domElement,elementPositionState)=>this._eventHandlersMemo[memoIndex]||(this._eventHandlersMemo[memoIndex]=evt=>{if("none"===domElement.style.pointerEvents){let event="touchmove"===evt.type?evt.changedTouches[0]:evt;domElement.style.left=`\n                    ${event.clientX-elementPositionState.distanceX}px\n                `;domElement.style.top=`\n                    ${event.clientY-elementPositionState.distanceY}px\n                `}});async _getExamToolbarLocalStorageData(){return await new Promise((resolve=>{try{chrome.storage.local.get(["bypass_status","launch_meta","toolbar_data","is_calculator_active","is_exam_tools_minimized","has_password_been_inserted","proctor_toolbar_update_browser_guard_active","proctor_toolbar_update_calculator_type","proctor_toolbar_update_whitelisted_urls","proctor_toolbar_update_allowed_applications","toolbar_calculator_position","toolbar_webcam_position","is_webcam_active","is_webcam_compressed","webcam_device_label","guardModeStatus"],(storage=>{resolve(storage)}))}catch(error){void 0}}))}async _setTimeoutPromise(callback,delayTime){return await new Promise((resolve=>setTimeout((()=>{callback();resolve()}),delayTime)))}}globalThis.hlExamTools=new ExamTools(hlA11yHelper,hlIcons);