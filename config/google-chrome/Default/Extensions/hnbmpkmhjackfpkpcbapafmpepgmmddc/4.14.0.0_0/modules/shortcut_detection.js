class ShortcutDetection{_capturedKeys=null;_userOs="";_keyStrokeDelay=1e3;_notifyShortcutTests=new Set;_notifyTimeout=null;_keyBuffer=[];_lastKeyTime=Date.now();_detectedShortcuts={mac:[["f3"],["f4"],["f12"],["meta","shift"],["meta","alt"],["meta","alt","i"]],windows:[["f12"],["printscreen"],["printscreen","alt"],["printscreen","meta"],["meta","alt"],["meta","shift"],["meta","shift","s"],["control","shift","i"]],chrome:[["control","f5"],["control","shift"],["control","shift","i"],["control","shift","f5"]]};constructor(){this._identifyUserPlatform();this._setupShortcutTests();this._capturedKeys=this._getCapturedKeys();document.addEventListener("keyup",this._keySequenceCapture)}_keySequenceCapture=event=>{const key=event.key.toLowerCase();if(!this._capturedKeys.has(key))return;const currentTime=Date.now();const hasDelayExpired=currentTime-this._lastKeyTime>this._keyStrokeDelay;this._keyBuffer=hasDelayExpired?[key]:[...this._keyBuffer,key];this._lastKeyTime=currentTime;clearTimeout(this._notifyTimeout);this._notifyTimeout=setTimeout((()=>{this._notifyKeySequenceCaptured(this._keyBuffer)}),200)};_notifyKeySequenceCaptured(sequence){const uniqueSequenceValues=[...new Set(sequence)];const combinedSequence=uniqueSequenceValues.join("+");if(!this._notifyShortcutTests.has(combinedSequence))return;this._keyBuffer=[];chrome.runtime.sendMessage({message:"detected_shortcut_usage",data:combinedSequence})}_identifyUserPlatform(){let userPlatform=navigator?.userAgentData?.platform||navigator?.platform;userPlatform=userPlatform.toLowerCase();if(userPlatform.indexOf("mac")>-1){this._userOs="mac";return}if(userPlatform.indexOf("win")>-1){this._userOs="win";return}this._userOs="chrome"}_getCapturedKeys(){const universalKeys=["shift","i"];if("mac"===this._userOs)return new Set(["f3","f4","f12","alt","meta",...universalKeys]);if("win"===this._userOs)return new Set(["s","f12","alt","meta","control","printscreen",...universalKeys]);return new Set(["f5","control",...universalKeys])}_setupShortcutTests(){const getArrayPermutations=arrayElement=>{if(arrayElement.length<=2)return 2===arrayElement.length?[arrayElement,[arrayElement[1],arrayElement[0]]]:[arrayElement];return arrayElement.reduce(((accumulator,currentItem,index)=>accumulator.concat(getArrayPermutations([...arrayElement.slice(0,index),...arrayElement.slice(index+1)]).map((compiledArray=>[currentItem,...compiledArray])))),[])};const addValuesToShortcutTests=arrayElement=>{arrayElement.forEach((arrayItem=>{const arrayPermutations=getArrayPermutations(arrayItem);arrayPermutations.forEach((item=>{this._notifyShortcutTests.add(item.join("+"))}))}))};if("mac"===this._userOs){addValuesToShortcutTests(this._detectedShortcuts.mac);return}if("win"===this._userOs){addValuesToShortcutTests(this._detectedShortcuts.windows);return}addValuesToShortcutTests(this._detectedShortcuts.chrome)}}globalThis.hlShortcutDetection=new ShortcutDetection;