globalThis.BB_ULTRA_LMS_ID=6;globalThis.startExamPending=false;globalThis.examWasStarted=false;globalThis.isLiveChatActive=false;globalThis.isStartProctoringOverlayActive=false;globalThis.currentQuestion=null;const COPY_PASTE_EVENT_TYPES=["copy","cut","paste","dragstart","contextmenu"];globalThis.insertExamTools=function(){chrome.storage.local.get(null,(storage=>{exam_toggles=storage.exam_toggles;globalThis.translations=storage.translations;if("object"===typeof hlExamTools){const isExamUsingWebcam=1===parseInt(exam_toggles[1]["value"]);hlExamTools.init({environmentUrl:hl_url,activeLms:"blackboard-ultra",isExamUsingWebcam:isExamUsingWebcam,isExamBegin:startExamPending,translations:globalThis.translations});var append_menu=$(".panel-title-texteditor");if(append_menu)append_menu.append(`\n                    <div style="float: right; padding-right: 10px; display: inline-block">\n                        <div style="display:inline-block">${globalThis.translations.support_247}:&nbsp;&nbsp;&nbsp;&nbsp;</div>\n                        <button id="hl-livechat-link" style="display:inline-block" class="button-4">Livechat</button>\n                    </div>\n                `)}}))};function injectJS(code){let script=document.createElement("script");script.type="text/javascript";script.innerHTML=code;document.body.appendChild(script)}function removeListeners(){COPY_PASTE_EVENT_TYPES.forEach((eventType=>{document.removeEventListener(eventType,disableEvent)}));window.removeEventListener("focus",trackLoseFocus)}globalThis.postLog=function(event_type,question){chrome.storage.local.get(null,(storage=>{exam_id=storage.exam_id;student_id=storage.student_id;exam_toggles=storage.exam_toggles;lms_school_id=storage.lms_school_id;lms_student_id=storage.lms_student_id;lms_student_name=storage.lms_student_name;student_attempt=storage.student_attempt;var question_num=question.querySelector("legend").textContent;var question_html=question.querySelector("div[class*=question-container] div[role=presentation] p").outerHTML;var question_text=question.querySelector("div[class*=question-container] div[role=presentation] p").textContent;let logData={event_type:event_type,question_num:question_num,question_text:question_text,question_html:question_html,school_identifier:lms_school_id,exam_identifier:exam_id,student_identifier:lms_student_id,current_attempt:student_attempt,came_from_launch:true,user_name:lms_student_name,lms_id:BB_ULTRA_LMS_ID,hl_student_id:student_id};chrome.runtime.sendMessage({message:"lms_log",data:logData})}))};globalThis.disableEvent=event=>{event.preventDefault()};globalThis.addQuestionClickEvents=questionElements=>{questionElements.forEach((questionElement=>{questionElement.addEventListener("click",(()=>{let question=questionElement.closest("bb-assessment-question");postLog("Load",question)}))}))};globalThis.addQuestionListeners=()=>{const radioAnswers=document.querySelectorAll("bb-assessment-attempt input[type=radio]");addQuestionClickEvents(radioAnswers);const textQuestions=document.querySelectorAll("bb-assessment-attempt input[type=text]");addQuestionClickEvents(textQuestions);const richTextEditorQuestions=document.querySelectorAll("bb-assessment-attempt bb-rich-text-editor");addQuestionClickEvents(richTextEditorQuestions);const matchingQuestions=document.querySelectorAll("bb-matching-attempt");addQuestionClickEvents(matchingQuestions)};function disablePrinting(){var print_style=document.createElement("style");print_style.media="print";print_style.appendChild(document.createTextNode("body { visibility: hidden; display: none; }"));document.head.appendChild(print_style)}function postLogOnCopyPasteEvents(question){let eventsLogged={dragstart:"Drag and Drop",contextmenu:"Right Click",copy:"Copy",paste:"Paste",cut:"Cut"};COPY_PASTE_EVENT_TYPES.forEach((eventType=>{question.addEventListener(eventType,(event=>{postLog(eventsLogged[eventType],question)}))}))}function showAlertOnCopyPasteEvents(question){COPY_PASTE_EVENT_TYPES.forEach((eventType=>{let eventWarning=eventType;let eventsReadable={dragstart:globalThis.translations.forbidden_events.dragstart,contextmenu:globalThis.translations.forbidden_events.contextmenu,copy:globalThis.translations.forbidden_events.copy,paste:globalThis.translations.forbidden_events.paste,cut:globalThis.translations.forbidden_events.cut};question.addEventListener(eventType,(event=>{let capitalize=([firstLetter,...restOfWord])=>firstLetter.toUpperCase()+restOfWord.join("");hlAlert.showAlert("exam",capitalize(eventsReadable[eventWarning]),null,{timeout:3e3,style:""})}))}))}globalThis.disablingCopyPasteEvents=()=>{COPY_PASTE_EVENT_TYPES.forEach((eventType=>{document.addEventListener(eventType,disableEvent)}))};globalThis.removeLiveChatWidget=()=>{if(isLiveChatActive)injectJS(`LiveChatWidget.call('destroy')`);isLiveChatActive=false};globalThis.examClosed=()=>{examWasStarted=false;if(!!currentQuestion)postLog("Exam Browser Closed",currentQuestion);if("object"===typeof hlExamTools)hlExamTools.removeExamTools();chrome.runtime.sendMessage({message:"exam_window_closed"});chrome.runtime.sendMessage({message:"close_webcam",type:"relaunch"});removeListeners()};function showCalculator(calculatorType){if("object"===typeof hlExamTools)hlExamTools.proctorAddCalculatorToExam(calculatorType)}function toggleCalculator(setActiveState=null,forceFocus=true){if("object"===typeof hlExamTools)hlExamTools.toggleCalculator(setActiveState,forceFocus)}function hideCalculators(){if("object"===typeof hlExamTools)hlExamTools.proctorRemoveCalculatorFromExam()}function adjustWebcamPositionForChat(isActive){if("object"===typeof hlExamTools)hlExamTools.adjustWebcamPositionForChat(isActive)}function toggleWebcamVisibilty(shouldBeVisible){if("object"===typeof hlExamTools)hlExamTools.toggleWebcam(shouldBeVisible)}function toggleWebcamCompressed(shouldBeCompressed){if("object"===typeof hlExamTools)hlExamTools.toggleWebcamCompressed(shouldBeCompressed)}function trackExamClose(){var targetWin=window==window.parent?window.parent:window;targetWin.unloadHandler=examClosed;$(window).on("beforeunload",targetWin.unloadHandler)}function trackLoseFocus(){postLog("Test Window Lost Focus",currentQuestion)}globalThis.getActiveLmsExamId=async()=>{let p=new Promise((function(resolve,reject){chrome.storage.local.get(["lms_exam_id"],(function(storage){resolve(storage.lms_exam_id)}))}));return await p};function launchWebCamera(data){chrome.storage.local.get(null,(storage=>{chrome.runtime.sendMessage({message:"webcam_launch",url:hl_url+"/webapp/camera",session_id:data.session_id,lms_id:6,relaunch:0,display_count:storage.display_count,current_url:window.location.hostname})}))}function allowedScreens(){chrome.storage.local.get(null,(storage=>{if(Number(storage.exam_toggles[12]["value"]))chrome.runtime.sendMessage({message:"display_count"})}))}globalThis.relaunchWebCamera=function(){if(!!document.querySelector("bb-assessment-attempt"))chrome.storage.local.get(["bypass_status","translations"],(storage=>{if(!globalThis.translations&&storage.translations)globalThis.translations=storage.translations;if(!storage.bypass_status)pauseAllTabs(globalThis.translations.webcam.relaunch,true)}))};function pauseAllTabs(reason,relaunch=false){chrome.runtime.sendMessage({message:"pause_all_tabs",reason:[reason],relaunch:relaunch})}globalThis.focusChat=()=>{chrome.runtime.sendMessage({message:"focus_page"})};function insertLiveChat(student_name,student_id,exam_id,school_code="Not provided"){isLiveChatActive=true;const hlChatParameters={lmsSchoolId:school_code,examId:exam_id,studentId:student_id,lmsStudentName:student_name,lmsStudentEmail:student_name,license:livechat_license,withExamTools:true};hlChat.init(hlChatParameters);document.addEventListener("relaunchcam",(function(){chrome.storage.local.get(null,(storage=>{chrome.runtime.sendMessage({message:"webcam_launch",url:hl_url+"/webapp/camera",session_id:storage.session_id,lms_id:6,relaunch:1,display_count:storage.display_count,current_url:window.location.hostname})}))}));document.addEventListener("launchcam",(function(){chrome.storage.local.get(null,(storage=>{chrome.runtime.sendMessage({message:"webcam_launch",url:hl_url+"/webapp/camera",session_id:storage.session_id,lms_id:6,relaunch:0,display_count:storage.display_count,current_url:window.location.hostname})}))}));document.addEventListener("enableguard",(function(){chrome.storage.local.set({guardModeStatus:1});chrome.runtime.sendMessage({message:"enable_browser_guard"});chrome.runtime.sendMessage({message:"disable_new_tabs"});chrome.runtime.sendMessage({message:"begin_fullscreen"});chrome.runtime.sendMessage({message:"to_camera",msg:"enable_guard_camera"})}));document.addEventListener("focuschat",focusChat);document.addEventListener("cleanslate",(function(){chrome.storage.local.clear()}));document.addEventListener("disableguard",(function(){chrome.runtime.sendMessage({message:"disable_browser_guard"})}));document.addEventListener("opensesame",(function(){chrome.runtime.sendMessage({message:"bypass_payment"})}));document.addEventListener("nextstep",(function(){chrome.runtime.sendMessage({message:"livechat_command_nextstep"})}));document.addEventListener("cyclevideo",(function(){chrome.runtime.sendMessage({message:"cyclevideo"})}));document.addEventListener("exitfullscreen",(function(){chrome.runtime.sendMessage({message:"exit_fullscreen"});chrome.storage.local.set({fullscreen_override:1})}));document.addEventListener("showcalculator",(()=>showCalculator("basic")));document.addEventListener("showcalculatorsci",(()=>showCalculator("scientific")));document.addEventListener("hidecalculators",(()=>hideCalculators()));document.addEventListener("opencalculator",(()=>toggleCalculator(true)));document.addEventListener("opencalculatorsci",(()=>toggleCalculator(true)));document.addEventListener("closecalculators",(()=>toggleCalculator(false,false)));document.addEventListener("chat-started",(()=>adjustWebcamPositionForChat(true)));document.addEventListener("chat-ended",(()=>adjustWebcamPositionForChat(false)));document.addEventListener("showwebcam",(()=>toggleWebcamVisibilty(true)));document.addEventListener("hidewebcam",(()=>toggleWebcamVisibilty(false)));document.addEventListener("compresswebcam",(()=>toggleWebcamCompressed(true)));document.addEventListener("expandwebcam",(()=>toggleWebcamCompressed(false)))}