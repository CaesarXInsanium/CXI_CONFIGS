import Whitelist from"./modules/whitelist.js";import BrowserGuard from"./modules/browser_guard.js";import InjectDisableCopyPaste from"./modules/inject_disable_copy_paste.js";let isExamActive=false;let isUpdateAvailable=false;var winAdjustHeight=0;var winAdjustWidth=0;var trackWebTrafficListener=null;var webTrafficOn=false;var cameraTab=0;var externalExamInjectStatus=0;const isMac=navigator.platform.toUpperCase().indexOf("MAC")>-1;const isWin=navigator.platform.toUpperCase().indexOf("WIN")>-1;winOsAdjustHandler();let lms_window_id=null;let devtools_open=0;var exam_tab_id=null;let examWindowId=null;let camera_tab_id=null;let camera_window_id=null;let launch_page_tab_id=null;let launch_page_window_id=null;let external_exam_tab_id=null;let externalExamWindowId=null;let cameraBladeDimensions=null;let translations=null;initStartup();const whitelist=new Whitelist(["honorlock.com/webapp/camera","honorlock.com/assets/","honorlock.com/wp-content/","honorlock.com/canvas/","honorlock.com/bb/","honorlock.com/d2l/","honorlock.com/launch","dev0.honorlock.com/","dev3.honorlock.com/","dev6.honorlock.com/","demo.honorlock.com/","honorlock.com.test/","chrome://","honorlock.com/calc","honorlock.com/calc/scientific","honorlock.kb.help","honorlock://"]);const windowWhitelist=new Whitelist;const tabWhitelist=new Whitelist;const browserGuard=new BrowserGuard({whitelist:whitelist,windowWhitelist:windowWhitelist,tabWhitelist:tabWhitelist},{isMacUser:isMac,isWindowsUser:isWin});const disableCopyPaste=new InjectDisableCopyPaste;chrome.runtime.onUpdateAvailable.addListener((()=>{if(isExamActive){isUpdateAvailable=true;chrome.tabs.sendMessage(camera_tab_id,{action:"extension_update_during_exam"});return}chrome.runtime.reload()}));chrome.runtime.onMessageExternal.addListener((function(request,sender,callback){if("version"===request.message)callback({version:chrome.runtime.getManifest().version});if("uninstallme"===request.message){void 0;callback({message:"start-countdown"});chrome.management.uninstallSelf()}if("showFrame"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"show_frame"});callback({message:"sendFrame message received"})}));if("bbultra"===request.source&&("lti_launch_error"===request.type||"cancel_exam_start"===request.type))chrome.tabs.executeScript(sender.tab.id,{code:"window.history.back()"});if("bbultra"===request.source)chrome.tabs.sendMessage(sender.tab.id,{type:`bbultra_${request.type}`,data:request.data},(response=>{callback({response:response})}));if("getSourceId"===request.type){getSourceID(sender,callback);return true}if("isInstalled"===request.type)callback(true);if("reloadALEKS"===request.message)chrome.windows.getAll({populate:true},(function(windows){windows.forEach((function(window){window.tabs.forEach((function(tab){if(tab.url.indexOf("aleks.com/alekscgi")>-1)setTimeout((function(){chrome.tabs.reload(tab.id)}),500)}))}))}));if("resume_all_tabs"===request.message){resumeAllTabs();callback({message:"resume_all_tabs message received"})}return true}));chrome.commands.onCommand.addListener((function(command){chrome.management.getSelf((function(result){if("development"===result.installType){if("nextstep"===command)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"livechat_command_nextstep"})}));if("disableguard"===command)browserGuard.stop();if("clearlocalstorage"===command)clearLocalStorage()}}))}));chrome.storage.onChanged.addListener((function(changes,namespace){for(var storage_type in changes){let new_state=changes[storage_type].newValue;switch(storage_type){case"exam_state":examStateChange(new_state);break;case"camera_state":case"checklist_state":default:break}}}));function examStateChange(state){if("undefined"==typeof state)return true;switch(state.toLowerCase()){case"paused":initRecord=true;case"inactive":case"prelaunch":setBadge("ready");isExamActive=true;break;case"roomscan":initRecord=true;case"active":setBadge("recording");isExamActive=true;break;case"submitted":disableWebTrafficListeners();clearLocalStorage();resetWindowsAndTabs();clearActiveCameraSettings();case"override":case"fresh":default:setBadge("inactive");isExamActive=false;checkIfUpdateAvailable()}}function clearLocalStorage(callback){chrome.storage.local.clear((function(){!!chrome.runtime.lastError?void 0:printLocalStorage()}));"function"===typeof callback&&callback()}function checkIfUpdateAvailable(){if(isUpdateAvailable)setTimeout((()=>{chrome.runtime.reload()}),5e3)}function printLocalStorage(){chrome.storage.local.get(null,(function(result){!!result?prettyConsole(result):void 0}))}function getCameraDimensions(){return{windowWidth:(cameraBladeDimensions?cameraBladeDimensions.width:320)+winAdjustWidth,windowHeight:(cameraBladeDimensions?cameraBladeDimensions.height:490)+winAdjustHeight}}chrome.tabs.onActivated.addListener((tab=>badgeLogic(tab.tabId)));chrome.tabs.onUpdated.addListener(((tabId,tabInfo,tab)=>{if("complete"===tab.status&&tab.url&&tab.url.includes("honorlock.com/webapp/camera"))chrome.storage.local.get(["verified_install"],(storage=>{let checkVerifiedInstall=storage.verified_install;chrome.storage.local.set({verified_install:true});if(!checkVerifiedInstall)chrome.management.getSelf((result=>{chrome.tabs.sendMessage(tabId,{action:"hled",data:result})}))}));return badgeLogic(tabId)}));function badgeLogic(tab_id){chrome.storage.local.get(null,(storage=>{if(0===Object.keys(storage).length)chrome.tabs.query({},(tabs=>{let isLaunchAlive;if(storage.launch_url)isLaunchAlive=tabs.findIndex((tab=>storage.launch_url.includes(tab.url)));if(isLaunchAlive>-1)setBadge("ready");else chrome.tabs.get(tab_id,(response=>{if(whitelist.isDefault(response.url))setBadge("active");else setBadge("inactive")}))}))}))}var blinker;var red_dot=true;function startRecording(){blinker=setInterval((_=>{chrome.storage.local.get(null,(storage=>{if(red_dot)chrome.browserAction.setIcon({path:"assets/badges/recording-on.png"});else chrome.browserAction.setIcon({path:"assets/badges/recording-off.png"});red_dot=!red_dot}))}),1e3)}function stopRecording(){clearInterval(blinker)}var initRecord=true;function setBadge(state="ready"){if("recording"==state){if(initRecord){startRecording();initRecord=false}}else{if(blinker)stopRecording();chrome.browserAction.setIcon({path:"assets/badges/"+state+".png"})}}chrome.runtime.onMessage.addListener((async function(request,sender,sendResponse){if(request.type&&"proctoring"==request.type){if("proctoring_init"===request.message){chrome.storage.local.get(null,(storage=>{let id=storage.hasOwnProperty("launch_meta")?storage.launch_meta.student_id:storage.student_id;let lms_id=storage.hasOwnProperty("launch_meta")?storage.launch_meta.lms_id:storage.lms_id;let app_url=storage.hasOwnProperty("launch_meta")?storage.launch_meta.app_url:storage.app_url;let name=storage.hasOwnProperty("launch_meta")?storage.launch_meta.student_name:storage.student_name;let email=storage.hasOwnProperty("launch_meta")?storage.launch_meta.student_email:storage.student_email;let instructions_heading=storage.hasOwnProperty("launch_meta")?storage.launch_meta.translations.pop_in.heading:storage.translations.pop_in.heading;let instructions_title=storage.hasOwnProperty("launch_meta")?storage.launch_meta.translations.pop_in.title:storage.translations.pop_in.title;let livelook_proctor_messages=storage.hasOwnProperty("launch_meta")?storage.launch_meta.translations.proctor_messages:storage.translations.proctor_messages;let instructions=storage.hasOwnProperty("launch_meta")?storage.launch_meta.instructions:storage.exam_instructions;let target_tab=storage.hasOwnProperty("launch_meta")?storage.launch_tab_id:storage.exam_tab_id;let locale=storage.hasOwnProperty("lmsCourseLocale")?storage.lmsCourseLocale:"en";translations=storage.hasOwnProperty("launch_meta")?storage.launch_meta.translations:storage.translations;if(request.data){name=request.data.student_name;email=request.data.student_email}chrome.tabs.sendMessage(target_tab,{action:request.message,type:request.type,data:{app_url:app_url,student:{id:id,name:name,email:email},exam:{instructions:instructions,instructions_heading:instructions_heading,instructions_title:instructions_title,livelook_proctor_messages:livelook_proctor_messages},lms_id:lms_id,locale:locale}})}));chrome.storage.local.set({proctoring_state:true});chrome.storage.local.set({verified_install:false});if(request.data)chrome.storage.local.set({student_name:request.data.student_name,student_email:request.data.student_email})}else if("proctoring_end"===request.message){chrome.storage.local.get(null,(storage=>{let target_tab=storage.hasOwnProperty("launch_meta")?storage.launch_tab_id:storage.exam_tab_id;chrome.tabs.sendMessage(target_tab,{action:request.message,type:request.type})}));chrome.storage.local.remove("proctoring_state");chrome.storage.local.remove("verified_install")}else if("proctoring_check"==request.message)chrome.storage.local.get(["proctoring_state"],(storage=>sendResponse(storage.proctoring_state)));return true}if(request.message&&"alert"==request.message){let target_tab_id=null;if(exam_tab_id)target_tab_id=exam_tab_id;else if(external_exam_tab_id)target_tab_id=external_exam_tab_id;else if(launch_page_tab_id)target_tab_id=launch_page_tab_id;if(target_tab_id)chrome.tabs.sendMessage(target_tab_id,{type:"alert",alerts:request.var});return true}if("livelook_begin_flag"===request.message)chrome.tabs.sendMessage(camera_tab_id,{action:"livelook_begin_flag",data:request.data});if("livelook_comeplete_flag"===request.message)chrome.tabs.sendMessage(camera_tab_id,{action:"livelook_complete_flag",data:request.data});if("get_config"===request.message){void 0;getConfig(request,sender,sendResponse)}else if("health_check"===request.message)chrome.tabs.sendMessage(camera_tab_id,{action:"health_check"});else if("get_extID"===request.message)chrome.tabs.sendMessage(sender.tab.id,{action:"get_extID",data:chrome.runtime.id});else if("uninstall_self"===request.message){sendResponse("uninstall_success");chrome.management.uninstallSelf()}else if("uninstall_clear_page"===request.message)chrome.runtime.setUninstallURL("");else if("lms_init"===request.message){if(isUpdateAvailable){getTranslationsObject((()=>{alert(translations.background.update_required);chrome.runtime.reload()}));return}clearActiveCameraSettings();clearLocalStorage((function(){let result,resp;request.data["self"]="";$.ajax({url:hl_url+"/lms/studentinit",data:request.data,type:"POST",async:false,timeout:30,success:function(response){result=1;resp=response;if(!resp.student){result=0;return}translations=resp.translations;cameraBladeDimensions=resp.camera_blade_dimensions;chrome.storage.local.set({usat:resp.usat,app_url:resp.app_url,student_attempt:resp.student_attempt,bypass_status:resp.student.bypass_status,exam_id:resp.exam_id,exam_instructions:resp.exam_instructions,exam_toggles:resp.exam_toggles,lms_id:resp.lms_id,student_email:resp.student.signed_email,student_id:resp.student_id,session_id:resp.session_id,student_name:resp.student.user_name,school_code:resp.school_code,http_ref:resp.student.http_ref,lms_exam_id:request.data.lms_exam_id,lms_school_id:request.data.lms_school_id,lms_student_id:request.data.lms_student_id,lms_student_name:request.data.lms_student_name,camera_blade_dimensions:cameraBladeDimensions,translations:resp.translations,shortcut_detection_enabled:resp.shortcut_detection_enabled,toolbar_data:{additional_instructions:resp.additional_instructions,guidelines_allowed:resp.guidelines_allowed&&resp.guidelines_allowed.length?resp.guidelines_allowed:null,guidelines_not_allowed:resp.guidelines_not_allowed&&resp.guidelines_not_allowed.length?resp.guidelines_not_allowed:null,whitelisted_urls:resp.whitelisted_urls&&resp.whitelisted_urls.length?resp.whitelisted_urls:null,available_calculator_type:resp.exam_toggles?1===parseInt(resp.exam_toggles[19]["value"])?"basic":1===parseInt(resp.exam_toggles[28]["value"])?"scientific":null:null,allowed_applications:resp.allowed_applications&&resp.allowed_applications?resp.allowed_applications:null}});if(resp&&resp.session_id)chrome.runtime.setUninstallURL(hl_url+"/extension/uninstall/"+resp.session_id);let exam_url=new URL(request.data.href).hostname;whitelist.add(exam_url);if(resp.alerts)chrome.tabs.sendMessage(sender.tab.id,{type:"alert",alerts:resp.alerts})}}).fail((function(jQueryXHR,exception){result=0;resp=exception})).always((()=>sendResponse({result:result,response:resp})))}))}else if("lms_log"===request.message)chrome.tabs.sendMessage(camera_tab_id,{action:"store_log",data:request.data});else if("show_payment"===request.message){var height=642;if(request.var)height=parseInt(request.var);chrome.tabs.query({url:"https://*.honorlock.com/webapp/camera*"},(function(tabs){tabs.forEach((function(tab){chrome.windows.update(tab.windowId,{height:height+winAdjustHeight,focused:true,drawAttention:true})}))}))}else if("hide_payment"===request.message){const{windowHeight:windowHeight}=getCameraDimensions();chrome.tabs.query({url:"https://*.honorlock.com/webapp/camera*"},(function(tabs){tabs.forEach((function(tab){chrome.windows.update(tab.windowId,{height:windowHeight,focused:true})}))}))}else if("bypass_payment"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"bypass_payment"})}));else if("cyclevideo"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"cyclevideo"})}));else if("pause_assessment"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"pause_assessment"})}));else if("resume_assessment"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"resume_assessment"})}));else if("pause_all_tabs"===request.message){const livelook="livelook"===request.type?true:false;let pauseReasons=request.reason||[];let relaunch=request.relaunch||false;pauseAllTabs(livelook,pauseReasons,relaunch);chrome.storage.local.set({exam_state:"paused",pause_reasons:pauseReasons})}else if("resume_all_tabs"===request.message){resumeAllTabs();chrome.storage.local.set({exam_state:"active",pause_reasons:[]})}else if("clear_all_tabs"===request.message)resumeAllTabs();else if("is_exam_paused"===request.message){chrome.storage.local.get(null,(result=>{sendResponse(result)}));return true}else if("student_chat_id"===request.message)chrome.tabs.sendMessage(camera_tab_id,{action:"student_chat_id",data:request.chat_id});else if("open_support_chat"===request.message)chrome.storage.local.get(["launch_tab_id","exam_tab_id"],(storage=>{const target_tab=storage.launch_tab_id||storage.exam_tab_id;chrome.tabs.sendMessage(target_tab,{action:request.message,type:"proctoring",group_id:request.chat_group},(()=>{chrome.tabs.update(target_tab,{active:true})}))}));else if("highlight_page"===request.message)chrome.tabs.update(sender.tab.id,{active:true});else if("focus_page"===request.message)browserGuard.forceBrowserFocus(sender.tab.windowId,sender.tab.id);else if("webcam_start"===request.message){let url_regex=new RegExp(".+.honorlock.com/webapp/camera.+");let universal_regex=new RegExp(".+.honorlock.com/webrtc/init.+");let webcam_tabId="";chrome.windows.getAll({populate:true},(function(windows){windows.forEach((function(window){window.tabs.forEach((function(tab){if(tab.url.match(/(?=.*\bcourses\b)(?=.*\bquizzes\b)(?=.*\btake\b).+/g)){chrome.tabs.update(tab.id,{selected:true});chrome.windows.update(window.id,{focused:true,drawAttention:true})}}))}))}));chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i){if(url_regex.test(tabs[i].url))webcam_tabId=tabs[i].id;if(universal_regex.test(tabs[i].url))webcam_tabId=tabs[i].id}}));chrome.tabs.onRemoved.addListener(cameraRelaunch)}else if("webcam_error"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"webcam_error"})}));else if("webcam_relaunch"===request.message){let url_regex=new RegExp(".+.honorlock.com/webapp/camera.+");let universal_regex=new RegExp(".+.honorlock.com/webrtc/init.+");let webcam_tabId="";chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i){chrome.tabs.sendMessage(tabs[i].id,{action:"webcam_restarted"});if(url_regex.test(tabs[i].url))webcam_tabId=tabs[i].id;if(universal_regex.test(tabs[i].url))webcam_tabId=tabs[i].id}}));chrome.tabs.onRemoved.addListener(cameraRelaunch)}else if("camera_window_closed"===request.message){const targetId=getExamTabId();if(targetId)chrome.tabs.sendMessage(targetId,{action:"camera_window_closed"},(()=>{checkIfWebcamExistsDuringActiveExam(targetId)}))}else if("start_room_scan"===request.message)chrome.storage.local.set({exam_state:"roomscan"});else if("room_scan_complete"===request.message){chrome.storage.local.set({exam_state:"prelaunch"});initRecord=true}else if(request.message&&request.message.match(/open_.*_guide/gm)){browserGuard.fullscreen.stop();const guideUrls={open_canvas_guide:"https://honorlock.com/canvas/guide",open_canvas_universal_guide:"https://honorlock.com/canvas/universal/guide",open_blackboard_guide:"https://honorlock.com/bb/students",open_d2l_guide:"https://honorlock.com/d2l/students"};chrome.windows.create({url:guideUrls[request.message],type:"popup",left:100,top:100,height:800,width:600},(window=>windowWhitelist.add(window.id)))}else if("close_webcam"===request.message){if("submit"==request.type)chrome.storage.local.set({exam_state:"submitted"});chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)if(request.loc&&"update"===request.loc)chrome.tabs.sendMessage(tabs[i].id,{action:"close_webcam",data:"update"});else chrome.tabs.sendMessage(tabs[i].id,{action:"close_webcam"})}))}else if("close_all_webcam_windows"===request.message){resumeAllTabs();closeAllWebcamWindows()}else if("exam_window_closed"===request.message){browserGuard.stop();browserGuard.disableBlockNewTabs();clearActiveCameraSettings();resumeAllTabs();disableWebTrafficListeners()}else if("focus_webcam"===request.message)chrome.tabs.query({url:"https://*.honorlock.com/webapp/camera*"},(function(tabs){tabs.forEach((function(tab){chrome.tabs.update(tab.id,{selected:true});chrome.windows.update(tab.windowId,{focused:true,drawAttention:true})}))}));else if("check_webcam"===request.message)checkIfWebcamExistsDuringActiveExam(sender.tab.id);else if("webcam_open"===request.message){chrome.storage.local.set({webcam_tab_id:sender.tab.id});chrome.storage.local.get(["exam_state"],(result=>{if("active"!=result.exam_state&&"paused"!=result.exam_state)chrome.storage.local.set({exam_state:"prelaunch"})}));chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"webcam_open"})}))}else if("webcam_launch"===request.message){let sd={url:request.url,session_id:request.session_id,lms_id:request.lms_id,relaunch:request.relaunch,display_count:request.display_count,current_url:request.current_url};let params="?session_id="+sd.session_id+"&lms_id="+sd.lms_id+"&relaunch="+sd.relaunch+"&display_count="+sd.display_count;const{windowWidth:windowWidth,windowHeight:windowHeight}=getCameraDimensions();let window_options={url:sd.url+params,type:"popup",left:0,top:0,height:windowHeight,width:windowWidth};const isRelaunch=!!request.relaunch;if(!isRelaunch)chrome.windows.update(sender.tab.windowId,{state:"normal"});chrome.tabs.query({url:"https://*.honorlock.com/webapp/camera*"},(function(tabs){tabs.forEach((function(tab){chrome.tabs.remove(tab.id)}))}));if(isRelaunch&&browserGuard.forceFocus.isActive)browserGuard.forceFocus.stop();setTimeout((function(){chrome.windows.create(window_options,(function(window){camera_window_id=window.id;camera_tab_id=window.tabs[0].id;windowWhitelist.add(sender.tab.windowId);windowWhitelist.add(window.id);if(isRelaunch&&browserGuard.fullscreen.isActive)browserGuard.forceFocus.start(camera_tab_id);chrome.tabs.onRemoved.addListener((function(tab_id){if(tab_id==window.tabs[0].id){chrome.tabs.sendMessage(sender.tab.id,{action:"webcam_closed_begin"});chrome.storage.local.set({webcam_tab_id:null})}}))}))}),150)}else if("webcam_launch_external"===request.message){camera_window_id=-1;lms_window_id=sender.tab.windowId;launch_page_tab_id=sender.tab.id;launch_page_window_id=sender.tab.windowId;let sd={session_id:request.session_id,lms_id:request.lms_id,relaunch:request.relaunch,display_count:request.display_count,current_url:request.current_url};let params="?session_id="+sd.session_id+"&lms_id="+sd.lms_id+"&relaunch="+sd.relaunch+"&display_count="+sd.display_count;if(!cameraBladeDimensions)cameraBladeDimensions=request.camera_blade_dimensions?request.camera_blade_dimensions:null;const{windowWidth:windowWidth,windowHeight:windowHeight}=getCameraDimensions();let window_options={url:hl_url+"/webapp/camera"+params,type:"popup",left:0,top:0,height:windowHeight,width:windowWidth};const isRelaunch=!!request.relaunch;if(!isRelaunch)chrome.windows.update(launch_page_window_id,{state:"normal"});closeAllWebcamWindows();if(isRelaunch&&browserGuard.forceFocus.isActive)browserGuard.forceFocus.stop();setTimeout((function(){chrome.windows.create(window_options,(function(new_window){camera_window_id=new_window.id;camera_tab_id=new_window.tabs[0].id;windowWhitelist.add(launch_page_window_id);windowWhitelist.add(camera_window_id);if(isRelaunch&&browserGuard.fullscreen.isActive)browserGuard.forceFocus.start(camera_tab_id);chrome.storage.local.set({camera_state:"open"});chrome.tabs.onRemoved.addListener(cameraWindowClosed);function cameraWindowClosed(tabId){if(tabId===camera_tab_id){windowWhitelist.remove(camera_window_id);chrome.storage.local.set({camera_state:"closed"});camera_window_id=null;camera_tab_id=null;if(external_exam_tab_id)chrome.tabs.sendMessage(external_exam_tab_id,{action:"check_password_locked"},(function(response){if(!response)chrome.tabs.query({},(function(tabs){tabs.forEach((function(tab){chrome.tabs.sendMessage(tab.id,{action:"camera_window_closed"})}))}));else{unpinAllLaunchPages();chrome.storage.local.set({exam_state:"inactive"});chrome.tabs.query({},(function(tabs){tabs.forEach((function(tab){chrome.tabs.sendMessage(tab.id,{action:"reset_state"})}))}))}}));else{chrome.tabs.query({},(function(tabs){tabs.forEach((function(tab){chrome.tabs.sendMessage(tab.id,{action:"camera_window_closed"})}))}));chrome.storage.local.set({exam_state:"inactive"})}chrome.tabs.onRemoved.removeListener(cameraWindowClosed)}}}))}),150)}else if("checklist_complete"===request.message)chrome.tabs.query({url:lmsQuizUrl(request.var,0)},(function(tabs){for(var i=0;i<tabs.length;++i){var tab=tabs[i];chrome.tabs.sendMessage(tab.id,{action:"checklist_complete"},(function(response){if("undefined"!=typeof response){requestAccess(response,tab.id);if(tab.url.indexOf("aleks.com/alekscgi")>-1){chrome.tabs.update(tab.id,{selected:true});chrome.tabs.get(tab.id,(function(tab){chrome.windows.update(tab.windowId,{focused:true,drawAttention:true})}))}i=tabs.length}}))}}));else if("access_request"==request.message)if(request.bypass_set&&1==request.bypass_set){const usat=await getUsat().finally((usat=>usat));$.ajax({url:hl_url+"/lms/setAuth",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+usat)},data:request.data,type:"POST",async:true,success:function(response){requestAccess(request.data,sender.tab.id)}}).fail((function(jQueryXHR,exception){result=0}))}else requestAccess(request.data,sender.tab.id);else if("livechat_command_nextstep"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"livechat_command_nextstep"})}));else if("send_chat"===request.message){var exam_send_to=exam_tab_id;if(null==exam_tab_id)exam_send_to=launch_page_tab_id;chrome.tabs.sendMessage(exam_send_to,{action:"send_chat",message:request.var.message})}else if("display_count_bypass"===request.message)chrome.storage.local.set({display_count_bypass:1});else if("display_count"===request.message){displayCount(sender.tab.id);chrome.system.display.onDisplayChanged.addListener((function(){displayCount(sender.tab.id)}))}else if("display_count_pause_menu"===request.message)chrome.system.display.getInfo((function(displays){chrome.tabs.sendMessage(camera_tab_id,{action:"display_count",data:displays.length})}));else if("tab_count"===request.message){var lms_id=request.var;if(request.test_page)tabCount(sender.tab.id,lms_id);else{tabCount(sender.tab.id,lms_id);chrome.tabs.onCreated.addListener((function(tab){tabCount(sender.tab.id,lms_id)}));chrome.tabs.onRemoved.addListener((function(tab){tabCount(sender.tab.id,lms_id)}))}}else if("close_tabs"===request.message)chrome.tabs.query({},(function(tabs){tabs.forEach((function(tab){if(lmsQuizUrl(request.var,1).test(tab.url)||whitelist.isDefault(tab.url))return;chrome.tabs.remove(tab.id)}))}));else if("disable_new_tabs"===request.message)browserGuard.enableBlockNewTabs();else if("begin_fullscreen"===request.message||"resize_guard_window"===request.message){const targetExamTabId=getExamTabId();const targetTabId=targetExamTabId||sender.tab.id;const targetExamWindowId=getExamWindowId();const targetWindowId=targetExamWindowId||sender.tab.windowId;browserGuard.fullscreen.start({examTabId:targetTabId,windowId:targetWindowId,cameraTabId:camera_tab_id})}else if("exit_fullscreen"===request.message)browserGuard.fullscreen.stop();else if("enable_browser_guard"===request.message)getTranslationsObject((()=>{browserGuard.start(sender.tab.id,translations)}));else if("disable_browser_guard"===request.message)chrome.storage.local.get(null,(function(result){if(parseInt(result.guardModeStatus))browserGuard.stop();if("prelaunch"===result.exam_state||"roomscan"===result.exam_state)chrome.storage.local.set({exam_state:"fresh"})}));else if("enable_copy_paste"===request.message)chrome.storage.local.get(["exam_toggles"],(storage=>{storage.exam_toggles[2].value=0;chrome.storage.local.set({exam_toggles:storage.exam_toggles})}));else if("disable_copy_paste"===request.message)chrome.storage.local.get(["exam_toggles"],(storage=>{storage.exam_toggles[2].value=1;chrome.storage.local.set({exam_toggles:storage.exam_toggles})}));else if("showcalculator"===request.message||"showcalculatorsci"===request.message||"opencalculator"===request.message||"opencalculatorsci"===request.message||"hidecalculators"===request.message||"closecalculators"===request.message||"showwebcam"===request.message||"hidewebcam"===request.message||"compresswebcam"===request.message||"expandwebcam"===request.message){if(exam_tab_id){chrome.tabs.sendMessage(exam_tab_id,{action:request.message});return}if(launch_page_tab_id&&external_exam_tab_id){chrome.tabs.sendMessage(launch_page_tab_id,{action:request.message});chrome.tabs.sendMessage(external_exam_tab_id,{action:request.message})}if("opencalculator"===request.message&&external_exam_tab_id)chrome.tabs.update(external_exam_tab_id,{active:true,highlighted:true})}else if("track_web_traffic"===request.message){if(cameraTab!=sender.tab.id)cameraTab=sender.tab.id;if(webTrafficOn)return;chrome.tabs.onUpdated.addListener((function listener(tabId,changeInfo,tab){trackWebTrafficListener=listener;webTrafficOn=true;if("complete"==changeInfo.status&&cameraTab!=tabId&&!lmsQuizUrl(request.var,1).test(tab.url)&&-1==tab.url.indexOf("chrome://newtab"))if(whitelist.isDefault(tab.url));else if(whitelist.isAllowed(tab.url))chrome.tabs.sendMessage(cameraTab,{action:"log_web_traffic_whitelisted",data:tab});else chrome.tabs.sendMessage(cameraTab,{action:"log_web_traffic",data:tab})}))}else if("whitelist_urls"===request.message){let reset_whitelist=request.var.reset;let reset_enable_whitelist=request.var.enable;if(1==reset_whitelist)whitelist.disable();if(whitelist.isEnabled())return;if(1!=reset_whitelist||1==reset_whitelist&&1==reset_enable_whitelist)browserGuard.disableBlockNewTabs();whitelist.reset().add(request.var.whitelist);tabWhitelist.reset().add(sender.tab.id);if(-1!=request.var.whitelistTab)tabWhitelist.add(request.var.whitelistTab);chrome.tabs.query({url:lmsQuizUrl(request.var.lms_id,0)},(function(tabs){tabs.forEach((function(tab){tabWhitelist.add(tab.id)}))}));if(1==reset_whitelist){browserGuard.disableBlockNewTabs();const filteredWhitelist=Array.isArray(request.var.whitelist)?request.var.whitelist.filter((url=>url!==request.var.universal_whitelist_url)):[];const sendToTabId=exam_tab_id?exam_tab_id:external_exam_tab_id;chrome.tabs.sendMessage(sendToTabId,{action:"update_toolbar_whitelist_urls",data:filteredWhitelist})}if(1!=reset_whitelist||1==reset_whitelist&&1==reset_enable_whitelist){browserGuard.enableBlockNewTabs();chrome.tabs.query({},(function(tabs){var closeCount=0;tabs.forEach((function(tab){if(!whitelist.isAllowed(tab.url)&&!tabWhitelist.isAllowed(tab.id,true)){chrome.tabs.remove(tab.id);closeCount++}}));if(closeCount)getTranslationsObject((()=>{tabWhitelist.getList().forEach((id=>{chrome.tabs.onUpdated.addListener((function testLoad(tabId,changeInfo,tabState){if(id==tabId&&"complete"==changeInfo.status){chrome.tabs.sendMessage(id,{action:"custom_msg",msg:translations.background.non_white_listed_tabs_closed,type:"error"});chrome.tabs.onUpdated.removeListener(testLoad)}}))}))}))}))}}else if("add_whitelist_url"===request.message)whitelist.add(request.url);else if("get_internal_whitelist"===request.message)sendResponse({result:whitelist.getDefaultList(),sender:sender.tab.url});else if("to_camera"===request.message)chrome.tabs.query({url:"https://*.honorlock.com/webapp/camera*"},(function(tabs){tabs.forEach((function(tab){chrome.tabs.sendMessage(tab.id,{action:request.msg})}))}));else if("init_external_exams"===request.message)initExternalExams();else if("exam_tab_id"===request.message){exam_tab_id=sender.tab.id;examWindowId=sender.tab.windowId;chrome.storage.local.set({exam_tab_id:sender.tab.id})}else if("start_exam"===request.message)chrome.storage.local.set({exam_state:"active"});else if("insert_password_external"===request.message)insertExternalAccessCode(request.var.session_id);else if("check_devtools_open"===request.message)sendResponse({count:devtools_open});else if("show_insert_password_button"===request.message){chrome.tabs.sendMessage(camera_tab_id,{action:"show_insert_password_button"});chrome.windows.update(camera_window_id,{focused:true,state:"normal"})}else if("password_insert_success"===request.message){chrome.tabs.onRemoved.addListener(honorlockPageExit);external_exam_tab_id=sender.tab.id;externalExamWindowId=sender.tab.windowId;chrome.storage.local.set({exam_state:"active",exam_tab_id:sender.tab.id});var data={whitelistURL:request.host,whitelistTab:external_exam_tab_id};chrome.tabs.sendMessage(camera_tab_id,{action:"password_insert_success",data:data});chrome.tabs.sendMessage(launch_page_tab_id,{action:"password_insert_success"});chrome.tabs.sendMessage(external_exam_tab_id,{action:"password_insert_success"});pinTabByID(launch_page_tab_id)}else if("insert_password_ready"===request.message)chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;i++)chrome.tabs.sendMessage(tabs[i].id,{action:"insert_password_ready"})}));else if("exit_honorlock_clicked"===request.message)getTranslationsObject((()=>{if(window.confirm(translations.background.exit_clicked)){if(null!=camera_tab_id)chrome.tabs.sendMessage(camera_tab_id,{action:"universal_set_end_exam"});if(null!=external_exam_tab_id)chrome.tabs.remove(external_exam_tab_id);else endExternalExamSession(true);isExamActive=false;browserGuard.stop();checkIfUpdateAvailable()}}));else if("launch_page_opened"===request.message){launch_page_tab_id=sender.tab.id;closeDuplicateLaunchPages(launch_page_tab_id);pinTabByID(launch_page_tab_id);chrome.storage.local.set({launch_tab_id:launch_page_tab_id});chrome.storage.local.get(null,(function(storage){if("active"==storage.exam_state)chrome.tabs.onRemoved.addListener(honorlockPageExit)}))}else if("relaunch_app_unlock"===request.message){chrome.tabs.sendMessage(camera_tab_id,{action:"relaunch_app_unlock"});chrome.windows.update(camera_window_id,{focused:true,state:"normal"})}else if("external_exam_exit_listener"===request.message){tabWhitelist.add(sender.tab.id);whitelist.add(sender.tab.url);external_exam_tab_id=sender.tab.id;externalExamWindowId=sender.tab.windowId;chrome.tabs.move(external_exam_tab_id,{windowId:launch_page_window_id,index:-1},(function(exam_tab){chrome.tabs.update(exam_tab.id,{active:true})}));pinTabByID(launch_page_tab_id);function externalExitHandler(tabId){void 0;if(tabId===external_exam_tab_id){endExternalExamSession();chrome.tabs.onRemoved.removeListener(externalExitHandler)}}chrome.tabs.onRemoved.addListener(externalExitHandler);sendResponse(true)}else if("inject_password_module"===request.message){if(1===externalExamInjectStatus){executePasswordScript(sender.tab.id,sender.frameId,sender.tab.windowId);externalExamInjectStatus=0}}else if("append_script"===request.message)new ScriptExecution(sender.tab.id).executeCodes(`var script_filename = '${request.filename}';`).then((s=>s.executeScripts("js_web/script_append.js")));else if("disable_whitelist_urls"===request.message)browserGuard.disableBlockNewTabs();else if("update_allowed_applications"===request.message){const sendToTabId=exam_tab_id?exam_tab_id:external_exam_tab_id;chrome.tabs.sendMessage(sendToTabId,{action:"update_toolbar_allowed_applications",data:request.var})}else if("start_disable_copy_paste"===request.message)disableCopyPaste.init();else if("blocked_copy_paste"===request.message)chrome.tabs.query({active:true,currentWindow:true},(tabs=>{chrome.tabs.sendMessage(tabs[0].id,{action:"show_blocked_event_notification",event_name:request.event_name})}));else if("check_update_available"===request.message)checkIfUpdateAvailable();else if("show_exam_webcam"===request.message){const targetId=getExamTabId();chrome.tabs.sendMessage(targetId,{action:"show_exam_webcam"})}else if("focus_exam_webcam"===request.message){const targetExamWindowId=getExamWindowId();const targetExamTabId=getExamTabId();browserGuard.forceBrowserFocus(targetExamWindowId,targetExamTabId)}else if("exam_webcam_begin_button_clicked"===request.message)chrome.tabs.sendMessage(camera_tab_id,{action:"exam_webcam_begin_button_clicked"});else if("minimize_proctor_window"===request.message)chrome.windows.update(camera_window_id,{state:"minimized"});else if("update_network_quality_level"===request.message){const targetId=getExamTabId();chrome.tabs.sendMessage(targetId,{action:"update_network_quality_level",level:request.var})}else if("set_camera_setting_active"===request.message){if(!request.url)return;chrome.contentSettings.camera.get({primaryUrl:request.url},(details=>{if("allow"===details.setting)return;const activeUrl=new URL(request.url);const activeCameraUrlPattern=activeUrl.port?`*://${activeUrl.hostname}:*/*`:`*://${activeUrl.host}/*`;chrome.contentSettings.camera.set({primaryPattern:activeCameraUrlPattern,setting:"allow"})}))}else if("clear_active_camera_settings"===request.message)clearActiveCameraSettings();else if("update_active_webcam_label"===request.message){const targetId=getExamTabId();chrome.tabs.sendMessage(targetId,{action:"update_active_webcam_label",label:request.var})}else if("detected_shortcut_usage"===request.message)chrome.tabs.sendMessage(camera_tab_id,{action:"detected_shortcut_usage",data:request.data})}));function initStartup(){var focused_lms_window=0;clearLocalStorage((function(){chrome.windows.getAll({populate:true},(function(windows){windows.forEach((function(window){window.tabs.forEach((function(tab){if(lmsQuizUrl(1,1).test(tab.url)||lmsQuizUrl(2,2).test(tab.url)||lmsQuizUrl(3,1).test(tab.url)||lmsQuizUrl(4,1).test(tab.url)||lmsQuizUrl(5,1).test(tab.url)||lmsQuizUrl(6,1).test(tab.url)||lmsQuizUrl(7,1).test(tab.url)){chrome.tabs.reload(tab.id);if(1!=focused_lms_window){chrome.tabs.update(tab.id,{active:true});focused_lms_window++}setTimeout((function(){chrome.tabs.sendMessage(tab.id,{action:"extension_ready"})}),3e3)}if(tab.url.indexOf("honorlock.com/extension/install")>-1)if(tab.url.indexOf("aleks")>-1||tab.url.indexOf("remove=0")>-1)chrome.tabs.reload(tab.id);else try{chrome.tabs.remove(tab.id)}catch(e){void 0}}))}))}))}))}function initExternalExams(){chrome.windows.onFocusChanged.addListener(lastFocusedWindow);chrome.runtime.onConnect.addListener((function(port){if("devtools-page"==port.name){if(0==devtools_open)if(external_exam_tab_id){chrome.tabs.sendMessage(external_exam_tab_id,{action:"devtools_open"});chrome.tabs.sendMessage(camera_tab_id,{action:"devtools_open"})}devtools_open++;port.onDisconnect.addListener((function(port){devtools_open--;if(0==devtools_open)if(external_exam_tab_id)chrome.tabs.sendMessage(external_exam_tab_id,{action:"devtools_closed"})}))}}))}function getTranslationsObject(callback){if(!callback)return;if(!!translations){callback();return}chrome.storage.local.get(["translations","launch_meta"],(results=>{translations=results.launch_meta?results.launch_meta.translations:results.translations;callback()}))}function honorlockPageExit(tabId){chrome.storage.local.get(null,(function(result){if(tabId===result.launch_tab_id){chrome.storage.local.set({launch_message:translations.background.do_not_close_tab});chrome.tabs.create({url:result.launch_url,pinned:true},(function(tab){chrome.tabs.sendMessage(tab.id,{action:"password_insert_success"})}))}if(tabId===result.webcam_tab_id)void 0}))}function cameraRelaunch(tabId){chrome.storage.local.get(null,(function(result){if(tabId===result.webcam_tab_id){chrome.tabs.onRemoved.removeListener(cameraRelaunch);chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i)chrome.tabs.sendMessage(tabs[i].id,{action:"relaunch_webcam",test:"start"})}))}}))}function lastFocusedWindow(windowId){if(-1===windowId)return true;if(-1===camera_window_id||null===camera_window_id)return true;if(windowId===camera_window_id)return true;if(lms_window_id===windowId)return true;lms_window_id=windowId}async function insertExternalAccessCode(sessionId){const usat=await getUsat().finally((usat=>usat));$.ajax({url:hl_url+"/lms/requestExternalAccess",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+usat)},data:{session_id:sessionId},type:"POST",async:true,success:function(result){if(1==result.status){let extAccessCode=result.access;extAccessCode=extAccessCode.substring(0,extAccessCode.length-2);chrome.tabs.query({active:true,windowId:lms_window_id},(function(tabs){if(!external_exam_tab_id){external_exam_tab_id=tabs[0].id;externalExamWindowId=tabs[0].windowId}if(whitelist.isDefault(tabs[0].url)){void 0;return true}chrome.tabs.sendMessage(tabs[0].id,{action:"check_external_code_exists"},(function(response){if(!response)injectPasswordModule(extAccessCode);else chrome.tabs.query({active:true,windowId:lms_window_id},(function(tabs){chrome.tabs.sendMessage(tabs[0].id,{action:"reinsert_access_code",access_code:extAccessCode})}))}))}))}else void 0}}).fail((function(jQueryXHR,exception){void 0}))}function injectPasswordModule(access_code){chrome.tabs.query({active:true,windowId:lms_window_id},(function(tabs){let active_tab_id=tabs[0].id;let window_id=tabs[0].windowId;if(!external_exam_tab_id){void 0;external_exam_tab_id=active_tab_id;externalExamWindowId=window_id}externalExamInjectStatus=1;new ScriptExecution(active_tab_id).executeCodesOptions({allFrames:true},`var access_code = "${access_code}";`);chrome.tabs.executeScript(active_tab_id,{file:"external_check.js",runAt:"document_end",allFrames:true},(result=>{if(result.every((pw_count=>0===pw_count)))executePasswordScript(active_tab_id,0,window_id)}))}))}function executePasswordScript(tab_id,frame_id,window_id){let opts={frameId:frame_id,runAt:"document_end"};new ScriptExecution(tab_id).executeScriptsOptions(opts,"jquery-3.1.0.min.js","assets/svg_icons.js","external_exams.js").then((s=>s.injectCssOptions(opts,"assets/external_exams.css","assets/fonts.css"))).then(chrome.windows.update(window_id,{focused:true,drawAttention:true}))}function endExternalExamSession(cancelled=false){chrome.windows.update(launch_page_window_id,{state:"normal",focused:true});browserGuard.stop();chrome.tabs.sendMessage(camera_tab_id,{action:"close_webcam"});chrome.tabs.query({},(function(tabs){tabs.forEach((tab=>{chrome.tabs.sendMessage(tab.id,{action:"halt_browser_guard"});chrome.tabs.sendMessage(tab.id,{action:"disable_universal_toolbar"});disableCopyPaste.remove()}))}));applyToAllFrameContent({},((tab,frame)=>{chrome.tabs.sendMessage(tab.id,{action:"re_enable_copy_paste"},{frameId:frame.frameId});disableCopyPaste.remove()}));if(cancelled){chrome.tabs.sendMessage(launch_page_tab_id,{action:"reset_state"});disableWebTrafficListeners()}else{chrome.storage.local.set({exam_state:"submitted"});chrome.tabs.sendMessage(launch_page_tab_id,{action:"exam_submitted"});chrome.tabs.update(launch_page_tab_id,{active:true,pinned:false});setTimeout((function(){resetWindowsAndTabs();clearLocalStorage();closeAllWebcamWindows();stopRecording();clearActiveCameraSettings();setBadge("active")}),5e3);printLocalStorage()}}function resetWindowsAndTabs(){lms_window_id=null;camera_tab_id=null;camera_window_id=null;launch_page_tab_id=null;launch_page_window_id=null;external_exam_tab_id=null;externalExamWindowId=null;exam_tab_id=null;examWindowId=null}function clearActiveCameraSettings(){chrome.contentSettings.camera.clear({scope:"regular"})}function resumeAllTabs(){chrome.tabs.query({},(function(tabs){for(var i=0;i<tabs.length;++i){if(tabs[i].url.startsWith("chrome://"))continue;chrome.tabs.executeScript(tabs[i].id,{file:"resume_tabs.js"},(_=>{let e=chrome.runtime.lastError;if(void 0!==typeof e);}))}}))}function pauseAllTabs(livelook=false,pauseReasons=[],relaunch=false){chrome.tabs.query({},(function(tabs){tabs.forEach((tab=>{if(tab.url.startsWith("chrome://"))return;if(/\b.honorlock.com\/launch\b/i.test(tab.url))return;if(livelook&&tab.id===exam_tab_id)return;let checkUrl=tab.hasOwnProperty("pendingUrl")?tab.pendingUrl:tab.url;if(!whitelist.isDefault(checkUrl)){let pauseTabs=()=>{chrome.tabs.executeScript(tab.id,{file:"pause_tabs.js"});let e=chrome.runtime.lastError;if("undefined"!=typeof e)void 0};getTranslationsObject((()=>{let codeString;if(pauseReasons.length)codeString=`var pause_reasons = ${JSON.stringify(pauseReasons)}; var camera_relaunch = ${relaunch}; var isExamTab = ${tab.id===exam_tab_id}; var translationStrings = ${JSON.stringify(translations)}`;else codeString=`var translationStrings = ${JSON.stringify(translations)}`;chrome.tabs.executeScript(tab.id,{code:codeString},(()=>pauseTabs()))}));chrome.tabs.insertCSS(tab.id,{file:"assets/pause_tabs.css"})}}))}))}function unpinAllLaunchPages(){chrome.tabs.query({url:"https://*.honorlock.com/launch*"},(function(tabs){tabs.forEach((function(tab){chrome.tabs.update(tab.id,{pinned:false})}))}))}function pinTabByID(tab_id){chrome.tabs.update(tab_id,{pinned:true})}function closeDuplicateLaunchPages(new_launch_tab_id){chrome.tabs.query({url:"https://*.honorlock.com/launch*"},(function(tabs){tabs.forEach((function(tab){if(tab.id!==new_launch_tab_id)chrome.tabs.remove(tab.id)}))}))}function winOsAdjustHandler(){if(isWin){winAdjustHeight=15;winAdjustWidth=16}}function closeAllWebcamWindows(){var pattern="https://*.honorlock.com/webapp/camera*";chrome.tabs.query({url:pattern},(function(tabs){tabs.forEach((function(tab){chrome.tabs.remove(tab.id)}))}))}function displayCount(tab_id){chrome.system.display.getInfo((function(displays){chrome.tabs.sendMessage(tab_id,{action:"display_count",data:displays.length})}))}function tabCount(tab_id,lms_id){chrome.tabs.query({},(function(tab_arr){var tabs=[];for(var i=0;i<tab_arr.length;i++){if(lmsQuizUrl(lms_id,1).test(tab_arr[i].url))continue;if(whitelist.isDefault(tab_arr[i].url))continue;tabs.push(tab_arr[i].id)}chrome.tabs.sendMessage(tab_id,{action:"tab_count",data:tabs.length})}))}function getSourceID(sender,callback){var tab=sender.tab;tab.url=sender.url;chrome.desktopCapture.chooseDesktopMedia(["screen"],tab,(function(sourceId){if(!sourceId||!sourceId.length){callback({error:"permissionDenied"});return}callback({sourceId:sourceId})}))}function requestAccess(data,tab_id){chrome.management.getSelf((async function(result){data["ext_info"]=result;const usat=await getUsat().finally((usat=>usat));$.ajax({url:hl_url+"/lms/requestAccess",beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Bearer "+usat)},data:data,type:"POST",async:true,success:function(response){if(1==response.status)chrome.tabs.sendMessage(tab_id,{action:"test_ready",data:response.access});else{var h=900;if(response.err_code)h=response.err_code;chrome.tabs.sendMessage(tab_id,{action:"checklist_complete"})}}}).fail((function(jQueryXHR,exception){}))}))}function lmsQuizUrl(lms_id,regex=0){var ret="";switch(parseInt(lms_id)){case 1:ret=regex?/\bwebapps\/assessment\/take\b|\bultra\/courses\/\b/i:["*://*/webapps/assessment/take/*","*://*/ultra/courses/*"];break;case 2:if(1==regex)ret=/\bcourses\b.*\bquizzes\b.*\btake\b/i;else if(2==regex)ret=/\bcourses\b.*\bquizzes/i;else ret="https://*/courses/*/quizzes/*";break;case 3:ret=regex?/\baleks\.com\/alekscgi\b/i:"*://*.aleks.com/alekscgi*";break;case 4:ret=regex?/\bd2l\/lms\/quizzing\/user\b|\bd2l\/le\/content\/.*\/viewContent\b/i:["*://*/d2l/lms/quizzing/*","*://*/d2l/le/content/*/viewContent/*"];break;case 5:ret=regex?/\bhttps:\/\/.*\.honorlock\.com\/launch\b/i:"https://*.honorlock.com/launch";break;case 6:ret=regex?/\bblackboard\.com\/ultra\/\b/i:"*://*.blackboard.com/ultra/*";break;case 7:ret=regex?/\bstudent\/activity\b.*\b|\bstudent\/path\/\b.*\bactivity\b.*\b|\bstudent\/collection\/\b.*\/path\/\b.*\/activity\/\b.*\b/i:["*://*/student/activity/*","*://*/student/path/*/activity/*","*://*/student/collection/*/path/*/activity/*"];break}return ret}function disableWebTrafficListeners(){browserGuard.disableBlockNewTabs();chrome.tabs.onUpdated.removeListener(trackWebTrafficListener);webTrafficOn=false}function prettyConsole(obj){var str=JSON.stringify(obj,null,4)}(function(){function ScriptExecution(tabId){this.tabId=tabId}ScriptExecution.prototype.executeScripts=function(fileArray){fileArray=Array.prototype.slice.call(arguments);return Promise.all(fileArray.map((file=>exeScript(this.tabId,file)))).then((()=>this))};ScriptExecution.prototype.executeScriptsOptions=function(opts,...fileArray){return Promise.all(fileArray.map((file=>exeScript(this.tabId,file,opts)))).then((()=>this))};ScriptExecution.prototype.executeCodes=function(codeArray){codeArray=Array.prototype.slice.call(arguments);return Promise.all(codeArray.map((code=>exeCodes(this.tabId,code)))).then((()=>this))};ScriptExecution.prototype.executeCodesOptions=function(opts,...codeArray){return Promise.all(codeArray.map((code=>exeCodes(this.tabId,code,opts)))).then((()=>this))};ScriptExecution.prototype.injectCss=function(fileArray){fileArray=Array.prototype.slice.call(arguments);return Promise.all(fileArray.map((file=>exeCss(this.tabId,file)))).then((()=>this))};ScriptExecution.prototype.injectCssOptions=function(opts,...fileArray){return Promise.all(fileArray.map((file=>exeCss(this.tabId,file,opts)))).then((()=>this))};function promiseTo(fn,tabId,info){return new Promise((resolve=>{fn.call(chrome.tabs,tabId,info,(x=>resolve()))}))}function exeScript(tabId,path,opts=null){let info={file:path};if(opts)info={...info,...opts};return promiseTo(chrome.tabs.executeScript,tabId,info)}function exeCodes(tabId,code,opts=null){let info={code:code,runAt:"document_end"};if(opts)info={...info,...opts};return promiseTo(chrome.tabs.executeScript,tabId,info)}function exeCss(tabId,path,opts=null){let info={file:path,runAt:"document_end"};if(opts)info={...info,...opts};return promiseTo(chrome.tabs.insertCSS,tabId,info)}window.ScriptExecution=ScriptExecution})();function applyToAllFrameContent(queryInfo,callback){chrome.tabs.query(queryInfo,(function(tabs){for(const tab of tabs)chrome.webNavigation.getAllFrames({tabId:tab.id},(function(frames){for(const frame of frames)callback(tab,frame)}))}))}function checkIfWebcamExistsDuringActiveExam(targetTabId){if(!isExamActive)return;chrome.tabs.query({url:"https://*.honorlock.com/webapp/camera*"},(function(tabs){if(!tabs||!tabs.length)chrome.tabs.sendMessage(targetTabId,{action:"relaunch_webcam",test:1})}))}function getExamTabId(){return exam_tab_id||external_exam_tab_id}function getExamWindowId(){return examWindowId||externalExamWindowId}